{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/media/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Create Supabase client with service role key for admin operations\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    )\n\n    // Get JWT token from request headers\n    const authorization = request.headers.get('authorization')\n    if (!authorization) {\n      console.log('No authorization header found in media API')\n      return NextResponse.json(\n        { error: 'Authorization header required' },\n        { status: 401 }\n      )\n    }\n\n    const token = authorization.replace('Bearer ', '')\n    \n    // Verify the JWT token and get user\n    const { data: { user }, error: authError } = await supabase.auth.getUser(token)\n    \n    if (authError || !user) {\n      console.error('Token verification failed in media:', authError)\n      return NextResponse.json(\n        { error: 'Invalid or expired token', details: authError?.message },\n        { status: 401 }\n      )\n    }\n\n    console.log('âœ… Authenticated user in media:', user.email)\n\n    const body = await request.json()\n    const { \n      listing_id, \n      media_type, \n      url, \n      public_id, \n      order_index = 0,\n      is_primary = false \n    } = body\n\n    if (!listing_id || !url || !public_id) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    const { data, error } = await supabase\n      .from('listing_media')\n      .insert({\n        listing_id,\n        media_type,\n        url,\n        public_id,\n        order_index,\n        is_primary\n      })\n\n    if (error) {\n      console.error('Media insertion error:', error)\n      return NextResponse.json(\n        { error: error.message },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data\n    })\n\n  } catch (error: any) {\n    console.error('Upload media error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Failed to upload media' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,oEAAoE;QACpE,MAAM,WAAW,IAAA,gMAAY,gFAE3B,QAAQ,GAAG,CAAC,yBAAyB;QAGvC,qCAAqC;QACrC,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;QAC1C,IAAI,CAAC,eAAe;YAClB,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,cAAc,OAAO,CAAC,WAAW;QAE/C,oCAAoC;QACpC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO,CAAC;QAEzE,IAAI,aAAa,CAAC,MAAM;YACtB,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA4B,SAAS,WAAW;YAAQ,GACjE;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,kCAAkC,KAAK,KAAK;QAExD,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,UAAU,EACV,UAAU,EACV,GAAG,EACH,SAAS,EACT,cAAc,CAAC,EACf,aAAa,KAAK,EACnB,GAAG;QAEJ,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,WAAW;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,iBACL,MAAM,CAAC;YACN;YACA;YACA;YACA;YACA;YACA;QACF;QAEF,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,MAAM,OAAO;YAAC,GACvB;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAyB,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}