{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/promotions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { supabaseClient } from '@/lib/supabase-client'\nimport { createClient } from '@supabase/supabase-js'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n    )\n\n    const body = await request.json()\n    const { \n      listing_id, \n      promotion_type, \n      price,\n      duration_days = 30 \n    } = body\n\n    if (!listing_id || !promotion_type || !price) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    // Calculate end date\n    const start_date = new Date().toISOString()\n    const end_date = new Date(Date.now() + duration_days * 24 * 60 * 60 * 1000).toISOString()\n\n    const { data, error } = await supabase\n      .from('promoted_listings')\n      .insert({\n        listing_id,\n        promotion_type,\n        start_date,\n        end_date,\n        price: parseFloat(price),\n        paid: false\n      })\n\n    if (error || !data) {\n      return NextResponse.json(\n        { error: error?.message || 'Failed to create promotion' },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        promotion_id: (data as any).id,\n        payment_url: `/payment?promotion_id=${(data as any).id}&amount=${price}`\n      }\n    })\n\n  } catch (error: any) {\n    console.error('Create promotion error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Failed to create promotion' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,IAAA,gMAAY;QAK7B,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,UAAU,EACV,cAAc,EACd,KAAK,EACL,gBAAgB,EAAE,EACnB,GAAG;QAEJ,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,OAAO;YAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,aAAa,IAAI,OAAO,WAAW;QACzC,MAAM,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,gBAAgB,KAAK,KAAK,KAAK,MAAM,WAAW;QAEvF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,qBACL,MAAM,CAAC;YACN;YACA;YACA;YACA;YACA,OAAO,WAAW;YAClB,MAAM;QACR;QAEF,IAAI,SAAS,CAAC,MAAM;YAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,OAAO,WAAW;YAA6B,GACxD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,cAAc,AAAC,KAAa,EAAE;gBAC9B,aAAa,CAAC,sBAAsB,EAAE,AAAC,KAAa,EAAE,CAAC,QAAQ,EAAE,OAAO;YAC1E;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAA6B,GACvD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}