{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/lib/supabase-client.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables. Please check your .env.local file.')\n}\n\n// Create a single Supabase client for the entire app\nexport const supabaseClient = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: true,\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n  },\n  global: {\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json',\n    }\n  }\n})\n\n// Export as default for backward compatibility\nexport default supabaseClient\n\n// Helper function to fetch listings with proper error handling\nexport async function fetchListingsWithDetails(filters: {\n  category?: string;\n  searchQuery?: string;\n  priceRange?: { min?: string; max?: string };\n  subcategory?: string;\n  condition?: string;\n  sortBy?: string;\n  limit?: number;\n}) {\n  try {\n    const {\n      category = 'other',\n      searchQuery = '',\n      priceRange = {},\n      subcategory = '',\n      condition = '',\n      sortBy = 'created_at',\n      limit = 50\n    } = filters\n\n    let query = supabaseClient\n      .from('listings')\n      .select(`\n        *,\n        seller:users!listings_seller_id_fkey(\n          id,\n          full_name,\n          email,\n          avatar_url\n        )\n      `)\n      .eq('status', 'available')\n      .eq('category', category)\n\n    // Apply text search\n    if (searchQuery.trim()) {\n      query = query.or(`title.ilike.%${searchQuery}%,description.ilike.%${searchQuery}%`)\n    }\n\n    // Apply price range\n    if (priceRange.min) {\n      const min = parseInt(priceRange.min) || 0\n      query = query.gte('price', min)\n    }\n    if (priceRange.max) {\n      const max = parseInt(priceRange.max) || 1000000000\n      query = query.lte('price', max)\n    }\n\n    // Apply sorting\n    switch (sortBy) {\n      case 'price':\n        query = query.order('price', { ascending: true })\n        break\n      case 'price_desc':\n        query = query.order('price', { ascending: false })\n        break\n      case 'views':\n        query = query.order('views', { ascending: false })\n        break\n      case 'likes':\n        query = query.order('likes', { ascending: false })\n        break\n      default:\n        query = query.order('created_at', { ascending: false })\n    }\n\n    query = query.limit(limit)\n\n    const { data: listings, error: listingsError } = await query\n\n    if (listingsError) {\n      console.error('Error fetching listings:', listingsError)\n      return { listings: [], error: listingsError }\n    }\n\n    if (!listings || listings.length === 0) {\n      return { listings: [] }\n    }\n\n    // Fetch additional data in parallel\n    const listingIds = (listings as any[]).map(l => l.id)\n    \n    const [mediaResult, detailsResult] = await Promise.all([\n      supabaseClient\n        .from('listing_media')\n        .select('*')\n        .in('listing_id', listingIds)\n        .order('order_index', { ascending: true }),\n      supabaseClient\n        .from('other_item_details')\n        .select('*')\n        .in('listing_id', listingIds)\n    ])\n\n    // Process the data\n    const listingsWithDetails = (listings as any[]).map(listing => {\n      const listingMedia = mediaResult.data?.filter((m: any) => m.listing_id === listing.id) || []\n      const listingDetails = detailsResult.data?.find((d: any) => d.listing_id === listing.id)\n\n      return {\n        ...listing,\n        media: listingMedia.map((media: any) => ({\n          url: media.url,\n          public_id: media.public_id,\n          media_type: media.media_type,\n          is_primary: media.is_primary,\n          order_index: media.order_index\n        })),\n        other_details: listingDetails ? {\n          subcategory: (listingDetails as any).subcategory,\n          brand: (listingDetails as any).brand,\n          model: (listingDetails as any).model,\n          condition: (listingDetails as any).condition,\n          warranty_available: (listingDetails as any).warranty_available,\n          warranty_period: (listingDetails as any).warranty_period,\n          reason_for_selling: (listingDetails as any).reason_for_selling,\n          original_purchase_date: (listingDetails as any).original_purchase_date,\n          age_of_item: (listingDetails as any).age_of_item\n        } : undefined\n      }\n    })\n\n    // Apply additional filters after fetching\n    let filteredListings = listingsWithDetails\n    \n    if (subcategory) {\n      filteredListings = filteredListings.filter(l => \n        l.other_details?.subcategory === subcategory\n      )\n    }\n    \n    if (condition) {\n      filteredListings = filteredListings.filter(l => \n        l.other_details?.condition === condition\n      )\n    }\n\n    return { listings: filteredListings }\n  } catch (error) {\n    console.error('Error in fetchListingsWithDetails:', error)\n    return { listings: [], error }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/lib/auth.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database'\nimport { supabaseClient } from '@/lib/supabase-client'\n\nlet _supabaseAdmin: ReturnType<typeof createClient<Database>> | null = null\nlet _supabaseAuth: ReturnType<typeof createClient<Database>> | null = null\n\nexport const getSupabaseAdmin = () => {\n  if (!_supabaseAdmin) {\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n    if (!supabaseUrl || !supabaseServiceKey) {\n      throw new Error('Missing Supabase environment variables. Please check your .env.local file.')\n    }\n\n    _supabaseAdmin = createClient<Database>(supabaseUrl, supabaseServiceKey)\n  }\n  return _supabaseAdmin\n}\n\nexport const getSupabaseAuth = () => {\n  if (!_supabaseAuth) {\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n    if (!supabaseUrl || !supabaseServiceKey) {\n      throw new Error('Missing Supabase environment variables. Please check your .env.local file.')\n    }\n\n    _supabaseAuth = createClient<Database>(supabaseUrl, supabaseServiceKey)\n  }\n  return _supabaseAuth\n}\n\nexport const supabase = supabaseClient\n\n// For backward compatibility, export the getter functions with the same names\nexport const supabaseAdmin = getSupabaseAdmin\nexport const supabaseAuth = getSupabaseAuth\n\nexport const signUp = async (email: string, password: string, fullName: string) => {\n  const response = await fetch('/api/auth/register', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      email,\n      password,\n      fullName\n    })\n  })\n\n  const data = await response.json()\n\n  if (!response.ok) {\n    throw new Error(data.error || 'Registration failed')\n  }\n\n  return data\n}\n\nexport const signIn = async (email: string, password: string) => {\n  const { data, error } = await supabase.auth.signInWithPassword({\n    email,\n    password\n  })\n\n  if (error) throw error\n  return data\n}\n\nexport const signOut = async () => {\n  const { error } = await supabase.auth.signOut()\n  if (error) throw error\n}\n\nexport const getCurrentUser = async () => {\n  const { data: { user }, error } = await supabase.auth.getUser()\n  if (error) throw error\n  return user\n}\n\nexport const getUserProfile = async (userId: string) => {\n  const { data, error } = await supabase\n    .from('users')\n    .select('*')\n    .eq('id', userId)\n    .single()\n\n  if (error && error.code !== 'PGRST116') { // PGRST116 is the error code for \"no rows returned\"\n    throw error\n  }\n  return data\n}\n\nexport const updateUserProfile = async (userId: string, updates: any) => {\n  const authClient = supabaseAuth()\n  const { data, error } = await (authClient as any)\n    .from('users')\n    .update(updates)\n    .eq('id', userId)\n    .select()\n    .single()\n\n  if (error) throw error\n  return data\n}\n\nexport const resetPassword = async (email: string) => {\n  const { error } = await supabase.auth.resetPasswordForEmail(email)\n  if (error) throw error\n}\n\nexport const updatePassword = async (password: string) => {\n  const { error } = await supabase.auth.updateUser({\n    password\n  })\n\n  if (error) throw error\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;AAEA,IAAI,iBAAmE;AACvE,IAAI,gBAAkE;AAE/D,MAAM,mBAAmB;IAC9B,IAAI,CAAC,gBAAgB;QACnB,MAAM;QACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;QAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;YACvC,MAAM,IAAI,MAAM;QAClB;QAEA,iBAAiB,IAAA,gMAAY,EAAW,aAAa;IACvD;IACA,OAAO;AACT;AAEO,MAAM,kBAAkB;IAC7B,IAAI,CAAC,eAAe;QAClB,MAAM;QACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;QAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;YACvC,MAAM,IAAI,MAAM;QAClB;QAEA,gBAAgB,IAAA,gMAAY,EAAW,aAAa;IACtD;IACA,OAAO;AACT;AAEO,MAAM,WAAW,oJAAc;AAG/B,MAAM,gBAAgB;AACtB,MAAM,eAAe;AAErB,MAAM,SAAS,OAAO,OAAe,UAAkB;IAC5D,MAAM,WAAW,MAAM,MAAM,sBAAsB;QACjD,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;YACnB;YACA;YACA;QACF;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;IAChC;IAEA,OAAO;AACT;AAEO,MAAM,SAAS,OAAO,OAAe;IAC1C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;QAC7D;QACA;IACF;IAEA,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,MAAM,UAAU;IACrB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC7C,IAAI,OAAO,MAAM;AACnB;AAEO,MAAM,iBAAiB;IAC5B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC7D,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,MAAM,iBAAiB,OAAO;IACnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;IAET,IAAI,SAAS,MAAM,IAAI,KAAK,YAAY;QACtC,MAAM;IACR;IACA,OAAO;AACT;AAEO,MAAM,oBAAoB,OAAO,QAAgB;IACtD,MAAM,aAAa;IACnB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,AAAC,WAC5B,IAAI,CAAC,SACL,MAAM,CAAC,SACP,EAAE,CAAC,MAAM,QACT,MAAM,GACN,MAAM;IAET,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,MAAM,gBAAgB,OAAO;IAClC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,qBAAqB,CAAC;IAC5D,IAAI,OAAO,MAAM;AACnB;AAEO,MAAM,iBAAiB,OAAO;IACnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC;QAC/C;IACF;IAEA,IAAI,OAAO,MAAM;AACnB"}}]
}