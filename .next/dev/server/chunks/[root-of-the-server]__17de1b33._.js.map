{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/fix-rls/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Import supabase admin client\n    const { getSupabaseAdmin } = await import('@/lib/auth')\n    const supabase = getSupabaseAdmin()\n    \n    // Simple fix: Disable problematic policies temporarily\n    const fixes = [\n      // Drop recursive policies\n      'DROP POLICY IF EXISTS \"Admins can manage all users\" ON users;',\n      'DROP POLICY IF EXISTS \"Admins can manage all listings\" ON listings;', \n      'DROP POLICY IF EXISTS \"Admins can manage settings\" ON settings;',\n      'DROP POLICY IF EXISTS \"Admins can manage site settings\" ON site_settings;',\n      \n      // Create simple admin policies without recursion\n      `CREATE POLICY \"Admins can manage all users\" ON users\n        FOR ALL USING (auth.role() = 'service_role' OR (auth.role() = 'authenticated' AND auth.uid() IN ('admin-user-id-placeholder')));`,\n        \n      `CREATE POLICY \"Admins can manage all listings\" ON listings\n        FOR ALL USING (auth.role() = 'service_role' OR (auth.role() = 'authenticated' AND auth.uid() IN ('admin-user-id-placeholder')));`,\n        \n      `CREATE POLICY \"Admins can manage settings\" ON settings\n        FOR ALL USING (auth.role() = 'service_role' OR (auth.role() = 'authenticated' AND auth.uid() IN ('admin-user-id-placeholder')));`,\n        \n      `CREATE POLICY \"Admins can manage site settings\" ON site_settings\n        FOR ALL USING (auth.role() = 'service_role' OR (auth.role() = 'authenticated' AND auth.uid() IN ('admin-user-id-placeholder')));`,\n        \n      // Add default site settings\n      `INSERT INTO site_settings (admin_phone, whatsapp_phone, support_email, office_address) \n       VALUES ('+250737060025', '+250737060025', 'support@ikazeproperty.rw', 'Kigali, Rwanda')\n       ON CONFLICT DO NOTHING;`\n    ]\n    \n    for (const sql of fixes) {\n      // Use raw SQL execution through PostgREST\n      const { error } = await supabase.rpc('exec_sql', { query: sql })\n      \n      if (error && !error.message.includes('does not exist')) {\n        console.error('SQL Error:', error, 'for:', sql)\n      }\n    }\n    \n    return NextResponse.json({ success: true, message: 'RLS recursion fix applied' })\n    \n  } catch (err) {\n    console.error('Error:', err)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,+BAA+B;QAC/B,MAAM,EAAE,gBAAgB,EAAE,GAAG;QAC7B,MAAM,WAAW;QAEjB,uDAAuD;QACvD,MAAM,QAAQ;YACZ,0BAA0B;YAC1B;YACA;YACA;YACA;YAEA,iDAAiD;YACjD,CAAC;wIACiI,CAAC;YAEnI,CAAC;wIACiI,CAAC;YAEnI,CAAC;wIACiI,CAAC;YAEnI,CAAC;wIACiI,CAAC;YAEnI,4BAA4B;YAC5B,CAAC;;8BAEuB,CAAC;SAC1B;QAED,KAAK,MAAM,OAAO,MAAO;YACvB,0CAA0C;YAC1C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,YAAY;gBAAE,OAAO;YAAI;YAE9D,IAAI,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ,CAAC,mBAAmB;gBACtD,QAAQ,KAAK,CAAC,cAAc,OAAO,QAAQ;YAC7C;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAA4B;IAEjF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,UAAU;QACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}