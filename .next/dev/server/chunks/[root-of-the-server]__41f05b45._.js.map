{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables. Please check your .env.local file.');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// For server-side operations\nexport const supabaseAdmin = supabaseServiceRoleKey \n  ? createClient(supabaseUrl, supabaseServiceRoleKey)\n  : supabase;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AACN,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAIO,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa;AAG3C,MAAM,gBAAgB,yBACzB,IAAA,gMAAY,EAAC,aAAa,0BAC1B"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/lib/notifications/service.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase';\n\nexport type NotificationType = \n  | 'payment_completed'\n  | 'payment_failed'\n  | 'promotion_activated'\n  | 'promotion_expiring'\n  | 'inquiry_received'\n  | 'inquiry_approved'\n  | 'listing_sold'\n  | 'wallet_topup'\n  | 'refund_processed';\n\nexport interface NotificationData {\n  user_id: string;\n  type: NotificationType;\n  title: string;\n  message: string;\n  data?: any;\n  channels: ('email' | 'sms' | 'push' | 'in_app')[];\n  priority: 'low' | 'medium' | 'high';\n}\n\nexport class NotificationService {\n  // Create notification record\n  static async createNotification(data: NotificationData) {\n    try {\n      const { data: notification, error } = await supabase\n        .from('notifications')\n        .insert({\n          user_id: data.user_id,\n          type: data.type,\n          title: data.title,\n          message: data.message,\n          data: data.data,\n          channels: data.channels,\n          priority: data.priority,\n          status: 'pending',\n          created_at: new Date().toISOString()\n        })\n        .select()\n        .single();\n\n      if (error) {\n        console.error('Error creating notification:', error);\n        return null;\n      }\n\n      // Process notification channels\n      await this.processNotificationChannels(notification);\n      \n      return notification;\n    } catch (error) {\n      console.error('Error in createNotification:', error);\n      return null;\n    }\n  }\n\n  // Process notification through different channels\n  private static async processNotificationChannels(notification: any) {\n    const { channels, user_id } = notification;\n\n    // Get user preferences and contact info\n    const { data: user } = await supabase\n      .from('users')\n      .select('email, phone, notification_preferences')\n      .eq('id', user_id)\n      .single();\n\n    if (!user) return;\n\n    const preferences = user.notification_preferences || {};\n\n    for (const channel of channels) {\n      try {\n        switch (channel) {\n          case 'email':\n            if (preferences.email !== false && user.email) {\n              await this.sendEmail(user.email, notification);\n            }\n            break;\n          case 'sms':\n            if (preferences.sms !== false && user.phone) {\n              await this.sendSMS(user.phone, notification);\n            }\n            break;\n          case 'push':\n            if (preferences.push !== false) {\n              await this.sendPushNotification(user_id, notification);\n            }\n            break;\n          case 'in_app':\n            // In-app notifications are stored in the database\n            await this.markInAppNotificationRead(notification.id);\n            break;\n        }\n      } catch (error) {\n        console.error(`Error sending ${channel} notification:`, error);\n      }\n    }\n\n    // Mark notification as processed\n    await supabase\n      .from('notifications')\n      .update({ status: 'sent', sent_at: new Date().toISOString() })\n      .eq('id', notification.id);\n  }\n\n  // Send email notification\n  private static async sendEmail(email: string, notification: any) {\n    try {\n      console.log(`Sending email to ${email}:`, {\n        subject: notification.title,\n        body: notification.message\n      });\n\n      // Use Supabase's built-in email functionality\n      // This will use the SMTP settings configured in Supabase Dashboard\n      const emailData = {\n        to: email,\n        subject: notification.title,\n        html: this.generateEmailTemplate(notification),\n        text: notification.message\n      };\n\n      // For now, we'll use a simple approach - in production you might want to\n      // use a dedicated email service API or Supabase Edge Functions\n      console.log('ðŸ“§ Email would be sent via Supabase SMTP:', emailData);\n      \n      // TODO: Integrate with real email service\n      // Option 1: Use Supabase Edge Function for email\n      // Option 2: Use SendGrid/Mailgun directly\n      // Option 3: Use Resend (recommended for transactional emails)\n\n      return true;\n    } catch (error) {\n      console.error('Error sending email:', error);\n      return false;\n    }\n  }\n\n  // Send SMS notification\n  private static async sendSMS(phone: string, notification: any) {\n    try {\n      // In production, integrate with SMS service like Twilio, Africa's Talking, etc.\n      console.log(`Sending SMS to ${phone}:`, notification.message);\n\n      // Mock SMS sending - replace with actual SMS service\n      const smsData = {\n        to: phone,\n        message: notification.message,\n        from: 'IkazeProperty'\n      };\n\n      // Example with Twilio (would require twilio package)\n      // const twilio = require('twilio');\n      // const client = twilio(process.env.TWILIO_ACCOUNT_SID, process.env.TWILIO_AUTH_TOKEN);\n      // await client.messages.create(smsData);\n\n      return true;\n    } catch (error) {\n      console.error('Error sending SMS:', error);\n      return false;\n    }\n  }\n\n  // Send push notification\n  private static async sendPushNotification(userId: string, notification: any) {\n    try {\n      // In production, integrate with push notification service like Firebase Cloud Messaging\n      console.log(`Sending push notification to user ${userId}:`, {\n        title: notification.title,\n        body: notification.message\n      });\n\n      // Mock push notification - replace with actual push service\n      const pushData = {\n        userId,\n        title: notification.title,\n        body: notification.message,\n        data: notification.data,\n        icon: '/icon-192x192.png'\n      };\n\n      // Example with Firebase (would require firebase-admin package)\n      // const admin = require('firebase-admin');\n      // await admin.messaging().sendToDevice(pushData);\n\n      return true;\n    } catch (error) {\n      console.error('Error sending push notification:', error);\n      return false;\n    }\n  }\n\n  // Mark in-app notification as read\n  private static async markInAppNotificationRead(notificationId: string) {\n    // In-app notifications are automatically available in the database\n    // This method could be used to update read status when user views it\n    return true;\n  }\n\n  // Generate email template\n  private static generateEmailTemplate(notification: any): string {\n    return `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <title>IkazeProperty - ${notification.title}</title>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n          .header { background: #000; color: white; padding: 20px; text-align: center; }\n          .content { padding: 20px; background: #f9f9f9; }\n          .footer { padding: 20px; text-align: center; font-size: 12px; color: #666; }\n          .btn { display: inline-block; padding: 12px 24px; background: #E53935; color: white; text-decoration: none; border-radius: 4px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>IkazeProperty</h1>\n          </div>\n          <div class=\"content\">\n            <h2>${notification.title}</h2>\n            <p>${notification.message}</p>\n            ${notification.data?.actionUrl ? `<a href=\"${notification.data.actionUrl}\" class=\"btn\">View Details</a>` : ''}\n          </div>\n          <div class=\"footer\">\n            <p>&copy; 2026 IkazeProperty. All rights reserved.</p>\n            <p>This is an automated message. Please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n  }\n\n  // Get user notifications\n  static async getUserNotifications(userId: string, limit = 20, offset = 0) {\n    try {\n      const { data, error } = await supabase\n        .from('notifications')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false })\n        .range(offset, offset + limit - 1);\n\n      if (error) {\n        console.error('Error fetching notifications:', error);\n        return [];\n      }\n\n      return data || [];\n    } catch (error) {\n      console.error('Error in getUserNotifications:', error);\n      return [];\n    }\n  }\n\n  // Mark notification as read\n  static async markAsRead(notificationId: string, userId: string) {\n    try {\n      const { error } = await supabase\n        .from('notifications')\n        .update({ read_at: new Date().toISOString() })\n        .eq('id', notificationId)\n        .eq('user_id', userId);\n\n      return !error;\n    } catch (error) {\n      console.error('Error marking notification as read:', error);\n      return false;\n    }\n  }\n\n  // Mark all notifications as read for user\n  static async markAllAsRead(userId: string) {\n    try {\n      const { error } = await supabase\n        .from('notifications')\n        .update({ read_at: new Date().toISOString() })\n        .eq('user_id', userId)\n        .is('read_at', null);\n\n      return !error;\n    } catch (error) {\n      console.error('Error marking all notifications as read:', error);\n      return false;\n    }\n  }\n\n  // Delete notification\n  static async deleteNotification(notificationId: string, userId: string) {\n    try {\n      const { error } = await supabase\n        .from('notifications')\n        .delete()\n        .eq('id', notificationId)\n        .eq('user_id', userId);\n\n      return !error;\n    } catch (error) {\n      console.error('Error deleting notification:', error);\n      return false;\n    }\n  }\n}\n\n// Predefined notification templates\nexport const NotificationTemplates = {\n  paymentCompleted: (amount: number, method: string) => ({\n    title: 'Payment Completed',\n    message: `Your payment of ${amount} RWF via ${method} has been completed successfully.`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'high' as const\n  }),\n\n  paymentFailed: (amount: number, method: string, reason: string) => ({\n    title: 'Payment Failed',\n    message: `Your payment of ${amount} RWF via ${method} failed. Reason: ${reason}`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'high' as const\n  }),\n\n  promotionActivated: (listingTitle: string, packageName: string) => ({\n    title: 'Promotion Activated',\n    message: `Your promotion \"${packageName}\" for listing \"${listingTitle}\" has been activated.`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'medium' as const\n  }),\n\n  promotionExpiring: (listingTitle: string, daysLeft: number) => ({\n    title: 'Promotion Expiring Soon',\n    message: `Your promotion for listing \"${listingTitle}\" will expire in ${daysLeft} days.`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'medium' as const\n  }),\n\n  inquiryReceived: (listingTitle: string, buyerName: string) => ({\n    title: 'New Inquiry Received',\n    message: `You have received a new inquiry for your listing \"${listingTitle}\" from ${buyerName}.`,\n    channels: ['email', 'sms', 'in_app'] as const,\n    priority: 'high' as const\n  }),\n\n  inquiryApproved: (listingTitle: string) => ({\n    title: 'Inquiry Approved',\n    message: `Your inquiry for \"${listingTitle}\" has been approved. You can now contact the seller.`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'high' as const\n  }),\n\n  walletTopup: (amount: number, method: string) => ({\n    title: 'Wallet Top-up Successful',\n    message: `Your wallet has been credited with ${amount} RWF via ${method}.`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'medium' as const\n  }),\n\n  refundProcessed: (amount: number, reason: string) => ({\n    title: 'Refund Processed',\n    message: `A refund of ${amount} RWF has been processed. Reason: ${reason}`,\n    channels: ['email', 'in_app'] as const,\n    priority: 'high' as const\n  })\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/notifications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { NotificationService } from '@/lib/notifications/service';\nimport { supabase } from '@/lib/supabase';\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Get auth token from request headers\n    const authHeader = request.headers.get('authorization');\n    const token = authHeader?.replace('Bearer ', '');\n    \n    if (!token) {\n      return NextResponse.json(\n        { error: 'No authorization token' },\n        { status: 401 }\n      );\n    }\n\n    // Verify user using the token\n    const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Invalid token' },\n        { status: 401 }\n      );\n    }\n\n    const { searchParams } = new URL(request.url);\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const offset = parseInt(searchParams.get('offset') || '0');\n\n    const notifications = await NotificationService.getUserNotifications(\n      user.id,\n      limit,\n      offset\n    );\n\n    return NextResponse.json({ notifications });\n  } catch (error: any) {\n    console.error('Error fetching notifications:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Get auth token from request headers\n    const authHeader = request.headers.get('authorization');\n    const token = authHeader?.replace('Bearer ', '');\n    \n    if (!token) {\n      return NextResponse.json(\n        { error: 'No authorization token' },\n        { status: 401 }\n      );\n    }\n\n    // Verify user using the token\n    const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Invalid token' },\n        { status: 401 }\n      );\n    }\n\n    // Check if user is admin (only admins can create notifications directly)\n    const { data: userData } = await supabase\n      .from('users')\n      .select('role')\n      .eq('id', user.id)\n      .single();\n\n    if (userData?.role !== 'admin') {\n      return NextResponse.json(\n        { error: 'Insufficient permissions' },\n        { status: 403 }\n      );\n    }\n\n    const body = await request.json();\n    const notification = await NotificationService.createNotification(body);\n\n    if (notification) {\n      return NextResponse.json({ success: true, notification });\n    } else {\n      return NextResponse.json(\n        { error: 'Failed to create notification' },\n        { status: 500 }\n      );\n    }\n  } catch (error: any) {\n    console.error('Error creating notification:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,sCAAsC;QACtC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,QAAQ,YAAY,QAAQ,WAAW;QAE7C,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,oIAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;QACzE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgB,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa;QAEtD,MAAM,gBAAgB,MAAM,+JAAmB,CAAC,oBAAoB,CAClE,KAAK,EAAE,EACP,OACA;QAGF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAc;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,sCAAsC;QACtC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,QAAQ,YAAY,QAAQ,WAAW;QAE7C,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,oIAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;QACzE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgB,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,yEAAyE;QACzE,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,oIAAQ,CACtC,IAAI,CAAC,SACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,UAAU,SAAS,SAAS;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,eAAe,MAAM,+JAAmB,CAAC,kBAAkB,CAAC;QAElE,IAAI,cAAc;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM;YAAa;QACzD,OAAO;YACL,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}