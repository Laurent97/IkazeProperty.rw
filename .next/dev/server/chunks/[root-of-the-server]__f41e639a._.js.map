{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password, fullName } = await request.json()\n\n    if (!email || !password || !fullName) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    // Create admin client with service role key\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\n    \n    const adminClient = createClient<Database>(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    })\n    \n    // Step 1: Create auth user using admin method to bypass email confirmation\n    const { data: authData, error: authError } = await adminClient.auth.admin.createUser({\n      email,\n      password,\n      email_confirm: true, // Auto-confirm the email\n      user_metadata: {\n        full_name: fullName\n      }\n    })\n\n    if (authError) {\n      console.error('Auth error:', authError)\n      return NextResponse.json(\n        { error: authError.message },\n        { status: 400 }\n      )\n    }\n\n    // Step 2: Create user profile manually (bypassing trigger)\n    if (authData.user) {\n      const { error: profileError } = await (adminClient as any)\n        .from('users')\n        .insert({\n          id: authData.user.id,\n          email: authData.user.email!,\n          full_name: fullName,\n          role: 'user'\n        })\n\n      if (profileError) {\n        console.error('Profile creation error:', profileError)\n        // Don't fail the registration - user can still function\n        console.warn('User created but profile creation failed')\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      user: authData.user\n    })\n\n  } catch (error) {\n    console.error('Registration error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,UAAU;YACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,MAAM;QACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;QAEhE,MAAM,cAAc,IAAA,gMAAY,EAAW,aAAa,oBAAoB;YAC1E,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,2EAA2E;QAC3E,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,YAAY,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;YACnF;YACA;YACA,eAAe;YACf,eAAe;gBACb,WAAW;YACb;QACF;QAEA,IAAI,WAAW;YACb,QAAQ,KAAK,CAAC,eAAe;YAC7B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,UAAU,OAAO;YAAC,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,2DAA2D;QAC3D,IAAI,SAAS,IAAI,EAAE;YACjB,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,AAAC,YACpC,IAAI,CAAC,SACL,MAAM,CAAC;gBACN,IAAI,SAAS,IAAI,CAAC,EAAE;gBACpB,OAAO,SAAS,IAAI,CAAC,KAAK;gBAC1B,WAAW;gBACX,MAAM;YACR;YAEF,IAAI,cAAc;gBAChB,QAAQ,KAAK,CAAC,2BAA2B;gBACzC,wDAAwD;gBACxD,QAAQ,IAAI,CAAC;YACf;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,SAAS,IAAI;QACrB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}