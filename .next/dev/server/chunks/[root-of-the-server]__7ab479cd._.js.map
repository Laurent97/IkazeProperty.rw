{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables. Please check your .env.local file.');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// For server-side operations\nexport const supabaseAdmin = supabaseServiceRoleKey \n  ? createClient(supabaseUrl, supabaseServiceRoleKey)\n  : supabase;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AACN,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAIO,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa;AAG3C,MAAM,gBAAgB,yBACzB,IAAA,gMAAY,EAAC,aAAa,0BAC1B"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///D:/Apps/IkazeProperty.rw/src/app/api/ads/analytics/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { supabaseAdmin } from '@/lib/supabase'\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { campaignId, type, userAgent, ip, referrer } = body\n\n    if (!campaignId || !type) {\n      return NextResponse.json(\n        { error: 'Campaign ID and type are required' },\n        { status: 400 }\n      )\n    }\n\n    if (!['impression', 'click'].includes(type)) {\n      return NextResponse.json(\n        { error: 'Type must be either impression or click' },\n        { status: 400 }\n      )\n    }\n\n    // Record the analytics event using your existing table structure\n    const { data, error } = await supabaseAdmin\n      .from('ad_analytics')\n      .insert({\n        ad_campaign_id: campaignId,\n        event_type: type,\n        user_agent: userAgent,\n        ip_address: ip,\n        referrer: referrer,\n        event_data: {\n          timestamp: new Date().toISOString(),\n          source: 'web'\n        }\n      })\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error recording analytics:', error)\n      return NextResponse.json(\n        { error: 'Failed to record analytics' },\n        { status: 500 }\n      )\n    }\n\n    // Update campaign metrics using a simpler approach\n    const updateField = type === 'impression' ? 'impressions' : 'clicks'\n    \n    // First get current value, then update\n    const { data: currentCampaign } = await supabaseAdmin\n      .from('ad_campaigns')\n      .select(updateField)\n      .eq('id', campaignId)\n      .single()\n    \n    if (currentCampaign) {\n      const currentValue = (currentCampaign as any)[updateField] || 0\n      const { error: updateError } = await supabaseAdmin\n        .from('ad_campaigns')\n        .update({\n          [updateField]: currentValue + 1,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', campaignId)\n      \n      if (updateError) {\n        console.error('Error updating campaign metrics:', updateError)\n      }\n    }\n\n    return NextResponse.json({ \n      success: true, \n      analyticsId: data.id \n    })\n  } catch (error) {\n    console.error('Error in analytics API:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG;QAEtD,IAAI,CAAC,cAAc,CAAC,MAAM;YACxB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC;YAAC;YAAc;SAAQ,CAAC,QAAQ,CAAC,OAAO;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0C,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,iEAAiE;QACjE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAa,CACxC,IAAI,CAAC,gBACL,MAAM,CAAC;YACN,gBAAgB;YAChB,YAAY;YACZ,YAAY;YACZ,YAAY;YACZ,UAAU;YACV,YAAY;gBACV,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;YACV;QACF,GACC,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,mDAAmD;QACnD,MAAM,cAAc,SAAS,eAAe,gBAAgB;QAE5D,uCAAuC;QACvC,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,yIAAa,CAClD,IAAI,CAAC,gBACL,MAAM,CAAC,aACP,EAAE,CAAC,MAAM,YACT,MAAM;QAET,IAAI,iBAAiB;YACnB,MAAM,eAAe,AAAC,eAAuB,CAAC,YAAY,IAAI;YAC9D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,yIAAa,CAC/C,IAAI,CAAC,gBACL,MAAM,CAAC;gBACN,CAAC,YAAY,EAAE,eAAe;gBAC9B,YAAY,IAAI,OAAO,WAAW;YACpC,GACC,EAAE,CAAC,MAAM;YAEZ,IAAI,aAAa;gBACf,QAAQ,KAAK,CAAC,oCAAoC;YACpD;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,aAAa,KAAK,EAAE;QACtB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}