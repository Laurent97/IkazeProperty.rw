module.exports=[66718,a=>{"use strict";var b=a.i(87924);let c=a.i(72131).forwardRef(({className:a,type:c,...d},e)=>(0,b.jsx)("input",{type:c,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${a||""}`,ref:e,...d}));c.displayName="Input",a.s(["Input",()=>c])},41675,a=>{"use strict";let b=(0,a.i(70106).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);a.s(["Calendar",()=>b],41675)},210,a=>{"use strict";let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},24569,a=>{"use strict";let b=(0,a.i(70106).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);a.s(["Edit",()=>b],24569)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Clock",()=>b],41710)},62722,a=>{"use strict";let b=(0,a.i(70106).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],62722)},14548,29246,a=>{"use strict";let b=(0,a.i(70106).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);a.s(["Save",()=>b],14548);var c=a.i(87924);let d=a.i(72131).forwardRef(({className:a,...b},d)=>(0,c.jsx)("textarea",{className:`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${a||""}`,ref:d,...b}));d.displayName="Textarea",a.s(["Textarea",()=>d],29246)},15044,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(45222),e=a.i(92759),f=a.i(33508),g=a.i(46842),h=a.i(3314),i=a.i(99570),j=a.i(66718),k=a.i(91119),l=a.i(86304),m=a.i(11642);function n({inquiryId:n,customerId:o,customerName:p,customerEmail:q,isOpen:r,onToggle:s,userType:t="customer"}){let u,{user:v}=(0,m.useAuth)(),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),G=(0,c.useRef)(null),H=void 0!==r,I=H?r:w;(0,c.useEffect)(()=>{G.current?.scrollIntoView({behavior:"smooth"})},[y]),(0,c.useEffect)(()=>{I&&n&&J()},[I,n]);let J=async()=>{try{D(!0);let{supabaseClient:b}=await a.A(53215),{data:{session:c}}=await b.auth.getSession();if(!c?.access_token)return void console.error("No session token found");let d=await fetch(`/api/inquiries/${n}/chat`,{headers:{Authorization:`Bearer ${c.access_token}`}});if(d.ok){let a=((await d.json()).data||[]).map(a=>({...a,sender:a.sender_type,text:a.message,timestamp:a.created_at}));z(a)}else{let a=await d.json();console.error("Chat API error:",a),503===d.status&&console.error("Chat table not set up. Please contact administrator.")}}catch(a){console.error("Error loading messages:",a)}finally{D(!1)}},K=async()=>{if(!A.trim()||!v)return;let b={id:Date.now().toString(),text:A.trim(),sender:t,timestamp:new Date,senderName:v.email};try{F(!0),B("");let{supabaseClient:c}=await a.A(53215),{data:{session:d}}=await c.auth.getSession();if(!d?.access_token)throw Error("No session token");let e=await fetch(`/api/inquiries/${n}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.access_token}`},body:JSON.stringify({message:b.text,sender:t})});if(e.ok){let a=await e.json(),b={...a.data,sender:a.data.sender_type,text:a.data.message,timestamp:a.data.created_at};z(a=>[...a,b])}else{let a=await e.json();throw console.error("Send message API error:",a),Error(a.error||"Failed to send message")}}catch(a){console.error("Error sending message:",a),B(b.text),alert("Failed to send message. Please try again.")}finally{F(!1)}};if(!I)return null;let L=(u={},y.forEach(a=>{try{if(!a.timestamp){u["Unknown Date"]||(u["Unknown Date"]=[]),u["Unknown Date"].push(a);return}let b=new Date(a.timestamp).toDateString();u[b]||(u[b]=[]),u[b].push(a)}catch(b){console.error("Error grouping message by date:",b,a),u["Invalid Date"]||(u["Invalid Date"]=[]),u["Invalid Date"].push(a)}}),u);return(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,b.jsxs)(k.Card,{className:"w-full max-w-2xl h-[600px] flex flex-col",children:[(0,b.jsxs)(k.CardHeader,{className:"flex-shrink-0 border-b",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(d.MessageCircle,{className:"h-5 w-5 text-blue-600"}),(0,b.jsx)(k.CardTitle,{className:"text-lg",children:"Inquiry Chat"})]}),(0,b.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:p})]}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:H?s:()=>x(!w),children:(0,b.jsx)(f.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsxs)("p",{children:["Customer: ",p," (",q,")"]}),(0,b.jsxs)("p",{children:["Inquiry ID: ",n]})]})]}),(0,b.jsxs)(k.CardContent,{className:"flex-1 flex flex-col p-0 overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[C?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===y.length?(0,b.jsxs)("div",{className:"text-center text-gray-500 mt-8",children:[(0,b.jsx)(d.MessageCircle,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,b.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):Object.entries(L).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"flex items-center justify-center",children:(0,b.jsx)("div",{className:"bg-gray-100 rounded-full px-3 py-1",children:(0,b.jsx)("span",{className:"text-xs text-gray-600 font-medium",children:(a=>{try{if(!a)return"Unknown date";let b=new Date,c="string"==typeof a?new Date(a):a;if(isNaN(c.getTime()))return"Invalid date";if(c.toDateString()===b.toDateString())return"Today";let d=new Date(b);if(d.setDate(d.getDate()-1),c.toDateString()===d.toDateString())return"Yesterday";return c.toLocaleDateString()}catch(b){return console.error("Error formatting date:",b,"Input:",a),"Invalid date"}})(new Date(a))})})}),c.map(a=>(0,b.jsx)("div",{className:`flex ${"admin"===a.sender?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] ${"admin"===a.sender?"order-2":"order-1"}`,children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:["admin"===a.sender?(0,b.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-blue-600 font-medium",children:[(0,b.jsx)(h.Shield,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"Admin"})]}):(0,b.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-green-600 font-medium",children:[(0,b.jsx)(g.User,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a.senderName||"Customer"})]}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:(a=>{try{if(!a)return"Unknown time";let b="string"==typeof a?new Date(a):a;if(isNaN(b.getTime()))return"Invalid time";return b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(b){return console.error("Error formatting time:",b,"Input:",a),"Invalid time"}})(a.timestamp)})]}),(0,b.jsx)("div",{className:`rounded-lg px-4 py-2 ${"admin"===a.sender?"bg-blue-600 text-white border border-blue-700":"bg-gray-100 text-gray-900 border border-gray-300"}`,children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.text})})]})},a.id))]},a)),(0,b.jsx)("div",{ref:G})]}),(0,b.jsxs)("div",{className:"border-t p-4",children:[(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(j.Input,{value:A,onChange:a=>B(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),K())},placeholder:"Type your message...",disabled:E||!v,className:"flex-1"}),(0,b.jsx)(i.Button,{onClick:K,disabled:!A.trim()||E||!v,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:(0,b.jsx)(e.Send,{className:"h-4 w-4"})})]}),!v&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-2",children:"You must be logged in to send messages"})]})]})]})})}a.s(["default",()=>n])},53215,a=>{a.v(a=>Promise.resolve().then(()=>a(24507)))}];

//# sourceMappingURL=_c29707e7._.js.map