module.exports=[69225,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(210),g=a.i(16201),h=a.i(92e3),i=a.i(99570),j=a.i(91119),k=a.i(86304),l=a.i(66718),m=a.i(70430),n=a.i(80701),o=a.i(10849);function p({amount:a,currency:d="RWF",transactionType:e,listingId:f,adCampaignId:g,description:h,promotionPackage:p,listingTitle:q,onPaymentComplete:r,onPaymentError:s}){let[t,u]=(0,c.useState)("wallet"),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)("bitcoin"),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(0),[J,K]=(0,c.useState)(0),[L,M]=(0,c.useState)({});(0,c.useEffect)(()=>{N(),O()},[]),(0,c.useEffect)(()=>{P()},[t,a,p,L]),(0,c.useEffect)(()=>{"crypto"===t&&Q()},[t,B,a,F]),(0,c.useEffect)(()=>{(async()=>{if(["equity_bank","crypto","mtn_momo","airtel_money"].includes(t))try{let a=await fetch(`/api/payments/config/${t}`),b=await a.json();a.ok&&b?.config&&M(a=>({...a,[t]:b.config}))}catch(a){console.error("Failed to load payment config:",a)}})()},[t]);let N=async()=>{try{let a=await fetch("/api/payments/methods"),b=await a.json();if(a.ok&&b?.methods)return void E(b.methods.filter(a=>a.isActive))}catch(a){console.error("Failed to load payment methods:",a)}E([{id:"wallet",name:"wallet",displayName:"Wallet Balance",icon:"/icons/wallet.svg",description:"Use your available wallet balance",isActive:!0},{id:"mtn_momo",name:"mtn_momo",displayName:"MTN Mobile Money",icon:"/icons/mtn-momo.png",description:"Pay with MTN Mobile Money",isActive:!0,requiresPhone:!0},{id:"airtel_money",name:"airtel_money",displayName:"Airtel Money",icon:"/icons/airtel-money.png",description:"Pay with Airtel Money",isActive:!0,requiresPhone:!0},{id:"equity_bank",name:"equity_bank",displayName:"Equity Bank",icon:"/icons/equity-bank.png",description:"Bank transfer to Equity Bank",isActive:!0},{id:"crypto",name:"crypto",displayName:"Cryptocurrency",icon:"/icons/crypto.png",description:"Pay with Bitcoin, Ethereum, or USDT",isActive:!0,requiresCryptoSelection:!0,supportedCryptos:["bitcoin","ethereum","usdt"]}])},O=async()=>{try{let{data:{user:a}}=await o.supabase.auth.getUser();if(a){let{data:b}=await o.supabase.from("user_wallets").select("*").eq("user_id",a.id).single();y(b)}}catch(a){console.error("Failed to load user wallet:",a)}},P=()=>{let b=a;p&&(b=p.price);let c=0;if("wallet"!==t){let a=L[t]||{},d=Number(a.transaction_fee_percent||0),e=Number(a.fixed_fee||0);d||e?c=d/100*b+e:"crypto"===t&&(c=.01*b)}G({subtotal:b,transactionFee:c,total:b+c,currency:d,paymentMethod:t,promotionPackage:p,listingTitle:q})},Q=async()=>{try{let b=await fetch(`/api/payments/exchange-rate?from=${{bitcoin:"BTC",ethereum:"ETH",usdt:"USDT"}[B]}&to=RWF`),c=await b.json();if(!b.ok||!c?.rate)throw Error(c?.error||"Exchange rate unavailable");let d=(F?.total||a)/Number(c.rate);I(d),K(Number(c.rate))}catch(a){console.error("Failed to calculate crypto amount:",a)}},R=async()=>{w(!0);try{let{data:{session:b}}=await o.supabase.auth.getSession();if(!b?.access_token)return void s?.("User not authenticated");let c={payment_method:t,amount:F?.subtotal||a,currency:d,transaction_type:e||"payment",listing_id:f,ad_campaign_id:g,description:h||`Payment for ${e}`,metadata:{promotion_package_id:p?.id,listing_title:q},phone_number:z,crypto_type:B},i=await fetch("/api/payments/initiate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.access_token}`},body:JSON.stringify(c)}),j=await i.json();i.ok&&j.success?r?.(j):s?.(j.error||"Payment failed")}catch(a){console.error("Payment error:",a),s?.(a.message||"Payment failed")}finally{w(!1)}},S=x&&x.balance>=(F?.total||a),T=L.equity_bank||{},U=L.crypto||{},V={bitcoin:U?.bitcoin?.wallet_address,ethereum:U?.ethereum?.wallet_address,usdt:U?.usdt?.wallet_address};return(0,b.jsxs)("div",{className:"space-y-6",children:[F&&(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{children:"Payment Summary"})}),(0,b.jsxs)(j.CardContent,{className:"space-y-3",children:[p&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Promotion Package:"}),(0,b.jsx)("span",{className:"font-medium",children:p.name})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsxs)("span",{children:[F.subtotal.toLocaleString()," ",F.currency]})]}),F.transactionFee>0&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Transaction Fee:"}),(0,b.jsxs)("span",{children:[F.transactionFee.toLocaleString()," ",F.currency]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("span",{className:"text-red-600",children:[F.total.toLocaleString()," ",F.currency]})]})]})]}),x&&(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Available Balance"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[x.balance.toLocaleString()," ",x.currency]}),x.locked_balance>0&&(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Pending: ",x.locked_balance.toLocaleString()," ",x.currency]})]}),S?(0,b.jsx)(k.Badge,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Available"}):(0,b.jsx)(k.Badge,{variant:"destructive",children:"Insufficient"})]})})}),(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{children:"Select Payment Method"})}),(0,b.jsx)(j.CardContent,{className:"space-y-4",children:(0,b.jsx)("div",{className:"grid gap-3",children:D.map(c=>(0,b.jsxs)("div",{className:`relative border rounded-lg p-4 cursor-pointer transition-all ${t===c.id?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"} ${!S&&"wallet"===c.id?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{("wallet"!==c.id||S)&&u(c.id)},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("input",{type:"radio",name:"payment_method",value:c.id,checked:t===c.id,onChange:()=>{},disabled:!S&&"wallet"===c.id,className:"h-4 w-4 text-red-600 focus:ring-red-500"}),(0,b.jsx)("img",{src:c.icon,alt:c.displayName,className:"h-8 w-8 object-contain",onError:a=>{a.currentTarget.style.display="none"}}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium",children:c.displayName}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:c.description})]}),c.isActive&&(0,b.jsx)(k.Badge,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Active"})]}),c.requiresPhone&&t===c.id&&(0,b.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:`${c.id}_phone`,children:"Phone Number"}),(0,b.jsx)(l.Input,{id:`${c.id}_phone`,type:"tel",placeholder:"078X XXX XXX",value:z,onChange:a=>A(a.target.value),className:"mt-2"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"You will receive a payment prompt on your phone"})]}),c.requiresCryptoSelection&&t===c.id&&(0,b.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,b.jsx)(m.Label,{htmlFor:"crypto_type",children:"Select Cryptocurrency"}),(0,b.jsxs)(n.Select,{value:B,onValueChange:a=>C(a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"bitcoin",children:"Bitcoin (BTC)"}),(0,b.jsx)(n.SelectItem,{value:"ethereum",children:"Ethereum (ETH)"}),(0,b.jsx)(n.SelectItem,{value:"usdt",children:"USDT"})]})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,b.jsxs)("p",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Amount: "}),H.toFixed(8)," ",B.toUpperCase()]}),(0,b.jsxs)("p",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"≈ "}),a.toLocaleString()," ",d]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Exchange rate: 1 ",B.toUpperCase()," ≈ ",J.toLocaleString()," RWF"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{children:"Send to:"}),(0,b.jsx)("div",{className:"bg-white border p-3 rounded font-mono text-sm",children:V[B]||"Wallet address not configured"}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",className:"w-full",children:"Copy Address"})]})]}),"equity_bank"===c.id&&t===c.id&&(0,b.jsx)("div",{className:"mt-4 space-y-3",children:(0,b.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,b.jsx)("h4",{className:"font-medium mb-2",children:"Bank Transfer Instructions"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Bank:"})," Equity Bank Rwanda"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Account Name:"})," ",T.account_name||"Not configured"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Account Number:"})," ",T.account_number||"Not configured"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Reference:"})," IKZ",Date.now()]})]}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:"Please include the reference number in your transfer description"})]})})]},c.id))})})]}),(0,b.jsxs)("div",{className:"flex space-x-4",children:[(0,b.jsx)(i.Button,{variant:"outline",className:"flex-1",children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:R,disabled:v||!t||"wallet"===t&&!S,className:"flex-1 bg-red-600 hover:bg-red-700",children:v?"Processing...":`Pay ${F?.total?.toLocaleString()||a.toLocaleString()} ${d}`})]})]})}var q=a.i(24507),r=a.i(11642);let s={featured:{id:"featured",name:"Featured Listing",description:"Top placement and featured badge for 30 days",price:5e3,duration_days:30,features:["Top placement in search results","Featured badge","Increased visibility"],is_active:!0,sort_order:1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},urgent:{id:"urgent",name:"Urgent Listing",description:"Urgent badge and higher ranking for 14 days",price:3e3,duration_days:14,features:["Urgent badge","Higher ranking","Priority support"],is_active:!0,sort_order:2,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},video:{id:"video",name:"Video Showcase",description:"Video showcase for your listing for 7 days",price:4e3,duration_days:7,features:["Video showcase","Enhanced gallery","Social media sharing"],is_active:!0,sort_order:3,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},social:{id:"social",name:"Social Media Promotion",description:"Social media promotion for 3 days",price:1e3,duration_days:3,features:["Social media posts","Targeted advertising","Performance tracking"],is_active:!0,sort_order:4,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}};function t(){let a=(0,d.useRouter)(),l=(0,d.useSearchParams)(),{user:m}=(0,r.useAuth)(),[n,o]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=l.get("listing_id"),c=l.get("promotion");b&&c?(o(b),u(c),D(b)):a.push("/dashboard/my-listings")},[l,a]);let D=async a=>{try{let{data:{session:b}}=await (0,q.getSupabaseClient)().auth.getSession();if(!b?.access_token)throw Error("Not authenticated");let c=await fetch(`/api/listings/${a}`,{headers:{Authorization:`Bearer ${b.access_token}`}});if(!c.ok)throw Error("Failed to fetch listing");let d=await c.json();d.success&&d.data&&w(d.data.title)}catch(a){console.error("Error fetching listing:",a),A("Failed to load listing details")}},E=async b=>{y(!0);try{let{data:{session:c}}=await (0,q.getSupabaseClient)().auth.getSession();if(!c?.access_token)throw Error("Not authenticated");let d=s[t],e=await fetch("/api/promotions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.access_token}`},body:JSON.stringify({listing_id:n,promotion_type:t,price:d.price,duration_days:d.duration_days,payment_transaction_id:b.transaction?.id})}),f=await e.json();if(f.success)C(!0),setTimeout(()=>{a.push("/dashboard/my-listings?promotion_success=true")},3e3);else throw Error(f.error||"Failed to create promotion")}catch(a){console.error("Error creating promotion:",a),A(a.message||"Failed to create promotion after payment")}finally{y(!1)}},F=s[t];return n&&t&&F?B?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center max-w-md mx-auto",children:[(0,b.jsx)(g.CheckCircle,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Your listing has been successfully promoted. You will be redirected to your listings shortly."}),(0,b.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-green-800 mb-2",children:"Promotion Details"}),(0,b.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Promotion:"})," ",F.name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Duration:"})," ",F.duration_days," days"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Amount Paid:"})," ",F.price.toLocaleString()," RWF"]})]})]}),(0,b.jsx)(e.default,{href:"/dashboard/my-listings",children:(0,b.jsx)(i.Button,{className:"bg-red-600 hover:bg-red-700",children:"Go to My Listings"})})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)(e.default,{href:"/dashboard/my-listings",className:"inline-flex items-center text-gray-600 hover:text-gray-900 mb-4",children:[(0,b.jsx)(f.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to My Listings"]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Complete Your Promotion Payment"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Pay for your listing promotion to increase visibility"})]})]}),z&&(0,b.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start",children:[(0,b.jsx)(h.AlertCircle,{className:"h-5 w-5 text-red-600 mt-0.5 mr-3"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Payment Error"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:z})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{children:"Promotion Summary"})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:"Listing"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 truncate",children:v||"Loading..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:"Promotion Package"}),(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"font-medium text-red-800",children:F.name}),(0,b.jsxs)(k.Badge,{variant:"secondary",className:"bg-red-100 text-red-800",children:[F.duration_days," days"]})]}),(0,b.jsx)("p",{className:"text-sm text-red-700 mb-2",children:F.description}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[F.price.toLocaleString()," RWF"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Features Included"}),(0,b.jsx)("ul",{className:"space-y-1",children:F.features.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-center text-sm text-gray-600",children:[(0,b.jsx)(g.CheckCircle,{className:"h-4 w-4 text-green-600 mr-2 flex-shrink-0"}),a]},c))})]})]})]})}),(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{children:"Payment Details"})}),(0,b.jsx)(j.CardContent,{children:x?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Processing payment..."})]}):(0,b.jsx)(p,{amount:F.price,currency:"RWF",transactionType:"promotion",listingId:n,description:`Promotion payment for ${F.name}`,promotionPackage:F,listingTitle:v,onPaymentComplete:E,onPaymentError:a=>{A(a)}})})]})})]})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(h.AlertCircle,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Invalid Payment Request"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Missing required payment information"}),(0,b.jsx)(e.default,{href:"/dashboard/my-listings",children:(0,b.jsx)(i.Button,{className:"bg-red-600 hover:bg-red-700",children:"Back to My Listings"})})]})})}a.s(["default",()=>t],69225)}];

//# sourceMappingURL=src_app_%5Blocale%5D_payment_page_tsx_06937ab4._.js.map