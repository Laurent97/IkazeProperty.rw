module.exports=[96018,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(60246),f=a.i(81010),g=a.i(48464),h=a.i(79161),i=a.i(83497),j=a.i(63588),k=a.i(90166),l=a.i(24669),m=a.i(41710),n=a.i(16201),o=a.i(62722),p=a.i(92e3),q=a.i(77156),r=a.i(21161),s=a.i(99570),t=a.i(91119),u=a.i(63672);function v(){let[a,v]=(0,c.useState)({totalUsers:0,totalListings:0,pendingInquiries:0,completedTransactions:0,totalRevenue:0}),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(null);(0,c.useEffect)(()=>{G()},[]);let G=async()=>{try{let[a,b,c,d,e]=await Promise.all([u.supabase.from("users").select("id",{count:"exact"}),u.supabase.from("listings").select("id",{count:"exact"}),u.supabase.from("inquiries").select("id",{count:"exact",head:!0}).eq("status","pending"),u.supabase.from("transactions").select("id",{count:"exact",head:!0}).eq("status","completed"),u.supabase.from("transactions").select("commission_amount").eq("status","completed")]),f=e.data?.reduce((a,b)=>a+b.commission_amount,0)||0;v({totalUsers:a.count||0,totalListings:b.count||0,pendingInquiries:c.count||0,completedTransactions:d.count||0,totalRevenue:f});let{data:g}=await u.supabase.from("inquiries").select(`
          *,
          listings(title, category),
          buyer:users!inquiries_buyer_id_fkey(email, full_name),
          seller:users!inquiries_seller_id_fkey(email, full_name)
        `).eq("status","pending").order("created_at",{ascending:!1}).limit(5);x(g||[]);let{data:h}=await u.supabase.from("listings").select(`
          *,
          seller:users!listings_seller_id_fkey(email, full_name)
        `).order("created_at",{ascending:!1}).limit(5);z(h||[]);let{data:{session:i}}=await u.supabase.auth.getSession();if(i?.access_token){console.log("Fetching visit requests with token:",i.access_token.substring(0,20)+"...");let a=await fetch("/api/visits/admin",{headers:{Authorization:`Bearer ${i.access_token}`}});console.log("Visit response status:",a.status);let b=await a.json();console.log("Visit response data:",b),a.ok?B(b.visits||[]):console.error("Visit request error:",b.error)}}catch(a){console.error("Error fetching dashboard data:",a)}finally{D(!1)}},H=async(a,b)=>{try{await u.supabase.from("inquiries").update({status:b,admin_notes:"approved"===b?"Approved by admin":"Rejected by admin"}).eq("id",a),G()}catch(a){console.error("Error updating inquiry:",a)}},I=async a=>{try{F(a);let{data:{session:b}}=await u.supabase.auth.getSession();if(!b?.access_token)return;let c=await fetch("/api/visits/release",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.access_token}`},body:JSON.stringify({visit_request_id:a})});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to release payout")}G()}catch(a){console.error("Error releasing payout:",a)}finally{F(null)}},J=a=>{switch(a){case"houses":return(0,b.jsx)(f.Home,{className:"h-4 w-4"});case"cars":return(0,b.jsx)(g.Car,{className:"h-4 w-4"});case"land":return(0,b.jsx)(h.Trees,{className:"h-4 w-4"});default:return(0,b.jsx)(i.Package,{className:"h-4 w-4"})}};return C?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200 -mx-6 px-6 py-6 mb-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage IkazeProperty.rw platform"})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)(d.default,{href:"/dashboard/admin/users",children:(0,b.jsxs)(s.Button,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(e.Users,{className:"h-4 w-4 mr-2"}),"Users"]})}),(0,b.jsx)(d.default,{href:"/dashboard/admin/listings",children:(0,b.jsxs)(s.Button,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(f.Home,{className:"h-4 w-4 mr-2"}),"Listings"]})}),(0,b.jsx)(d.default,{href:"/dashboard/admin/inquiries",children:(0,b.jsxs)(s.Button,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(j.MessageSquare,{className:"h-4 w-4 mr-2"}),"Inquiries"]})}),(0,b.jsx)(d.default,{href:"/dashboard/admin/transactions",children:(0,b.jsxs)(s.Button,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(k.DollarSign,{className:"h-4 w-4 mr-2"}),"Transactions"]})}),(0,b.jsx)(d.default,{href:"/dashboard/admin/settings",children:(0,b.jsxs)(s.Button,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(r.Settings,{className:"h-4 w-4 mr-2"}),"Settings"]})})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(e.Users,{className:"h-4 w-4 text-blue-600"})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.totalUsers})]})]})})}),(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(f.Home,{className:"h-4 w-4 text-green-600"})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Listings"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.totalListings})]})]})})}),(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(m.Clock,{className:"h-4 w-4 text-yellow-600"})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending Inquiries"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.pendingInquiries})]})]})})}),(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 text-purple-600"})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.completedTransactions})]})]})})}),(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(k.DollarSign,{className:"h-4 w-4 text-red-600"})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["RWF ",a.totalRevenue.toLocaleString()]})]})]})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{children:(0,b.jsxs)(t.CardTitle,{className:"flex items-center",children:[(0,b.jsx)(p.AlertCircle,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Pending Inquiries (",w.length,")"]})}),(0,b.jsx)(t.CardContent,{children:0===w.length?(0,b.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No pending inquiries"}):(0,b.jsx)("div",{className:"space-y-4",children:w.map(a=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center mb-1",children:[J(a.listings.category),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:a.listings.title})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[(0,b.jsx)("strong",{children:"Buyer:"})," ",a.buyer.full_name||a.buyer.email]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[(0,b.jsx)("strong",{children:"Seller:"})," ",a.seller.full_name||a.seller.email]}),(0,b.jsx)("p",{className:"text-sm text-gray-700",children:a.message}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:new Date(a.created_at).toLocaleDateString()})]})}),(0,b.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,b.jsxs)(s.Button,{size:"sm",onClick:()=>H(a.id,"approved"),className:"bg-green-600 hover:bg-green-700",children:[(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,b.jsxs)(s.Button,{size:"sm",variant:"outline",onClick:()=>H(a.id,"rejected"),className:"border-red-600 text-red-600 hover:bg-red-50",children:[(0,b.jsx)(o.XCircle,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,b.jsx)(d.default,{href:`/dashboard/admin/inquiries/${a.id}`,children:(0,b.jsxs)(s.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(q.Eye,{className:"h-4 w-4 mr-1"}),"View"]})})]})]},a.id))})})]}),(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{children:(0,b.jsxs)(t.CardTitle,{className:"flex items-center",children:[(0,b.jsx)(l.TrendingUp,{className:"h-5 w-5 mr-2 text-blue-600"}),"Recent Listings"]})}),(0,b.jsx)(t.CardContent,{children:0===y.length?(0,b.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No listings yet"}):(0,b.jsx)("div",{className:"space-y-4",children:y.map(a=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center mb-1",children:[J(a.category),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:a.title})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Seller:"})," ",a.seller.full_name||a.seller.email]}),(0,b.jsxs)("p",{className:"text-lg font-bold text-red-600 mb-1",children:["RWF ",a.price.toLocaleString()]}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleDateString()})]}),(0,b.jsx)("div",{className:"ml-4",children:(0,b.jsx)("span",{className:`px-2 py-1 text-xs rounded-full ${"available"===a.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status})})]}),(0,b.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,b.jsx)(d.default,{href:`/listings/${a.category}/${a.id}`,children:(0,b.jsxs)(s.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(q.Eye,{className:"h-4 w-4 mr-1"}),"View"]})}),(0,b.jsx)(d.default,{href:`/dashboard/admin/listings/${a.id}`,children:(0,b.jsx)(s.Button,{size:"sm",variant:"outline",children:"Manage"})})]})]},a.id))})})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{children:(0,b.jsxs)(t.CardTitle,{className:"flex items-center",children:[(0,b.jsx)(k.DollarSign,{className:"h-5 w-5 mr-2 text-green-600"}),"Visit Fee Requests (",A.length,")"]})}),(0,b.jsx)(t.CardContent,{children:0===A.length?(0,b.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No visit requests"}):(0,b.jsx)("div",{className:"space-y-4",children:A.map(a=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center mb-1",children:[J(a.listings?.category),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:a.listings?.title||"Listing"})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Buyer:"})," ",a.buyer?.full_name||a.buyer?.email]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Seller:"})," ",a.seller?.full_name||a.seller?.email]}),a.seller?.phone_number&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Seller Phone:"})," ",a.seller.phone_number]}),a.listings?.visit_fee_payment_methods&&(0,b.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Payment Methods:"}),(0,b.jsx)("div",{className:"ml-2 mt-1 space-y-1",children:Object.entries(a.listings.visit_fee_payment_methods).map(([a,c])=>(0,b.jsxs)("div",{className:"text-xs",children:["mtn_momo"===a&&c?.phone_number&&(0,b.jsxs)("span",{children:["MTN MoMo: ",c.phone_number]}),"airtel_money"===a&&c?.phone_number&&(0,b.jsxs)("span",{children:["Airtel Money: ",c.phone_number]}),"equity_bank"===a&&c?.account_number&&(0,b.jsxs)("span",{children:["Equity: ",c.account_name||"Account"," • ",c.account_number]})]},a))})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-700",children:["Visit Fee: ",Number(a.visit_fee_amount||0).toLocaleString()," RWF"]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Status: ",a.status," • Payout: ",a.payout_status]})]})}),(0,b.jsx)("div",{className:"flex space-x-2 mt-3",children:(0,b.jsx)(s.Button,{size:"sm",onClick:()=>I(a.id),disabled:"paid"!==a.status||"released"===a.payout_status||E===a.id,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400",children:E===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-1"}),"Releasing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.DollarSign,{className:"h-4 w-4 mr-1"}),"Release to Seller (70%)"]})})})]},a.id))})})]})})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=src_app_%5Blocale%5D_dashboard_admin_page_tsx_2a835cd0._.js.map