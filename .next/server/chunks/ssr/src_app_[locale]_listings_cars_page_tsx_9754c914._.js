module.exports=[37811,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(87532),f=a.i(69012),g=a.i(24987),h=a.i(41675);let i=(0,a.i(70106).default)("fuel",[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5",key:"1wtuz0"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16",key:"e09ifn"}],["path",{d:"M2 21h13",key:"1x0fut"}],["path",{d:"M3 9h11",key:"1p7c0w"}]]);var j=a.i(21161),k=a.i(76472),l=a.i(77156),m=a.i(48464),n=a.i(99570),o=a.i(91119),p=a.i(68982);function q(){let[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)({min:"",max:""}),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("all"),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)(""),I=async()=>{try{F(!0);let{supabaseClient:b}=await a.A(53215);console.log("Starting to fetch car listings...");let{data:c,error:d}=await b.from("listings").select("*").eq("category","cars").eq("status","available").order("created_at",{ascending:!1});if(d){console.error("Error fetching basic listings:",d),H(`Failed to load listings: ${d.message}`);return}if(console.log(`Found ${c?.length||0} listings`),!c||0===c.length){D([]),F(!1);return}let e=c.map(a=>a.id),[{data:f,error:g},{data:h,error:i},{data:j,error:k}]=await Promise.all([b.from("users").select("id, full_name, email, avatar_url, phone_number, verified").in("id",c.map(a=>a.seller_id)),b.from("listing_media").select("id, listing_id, url, media_type, order_index, is_primary").in("listing_id",e).order("order_index"),b.from("car_details").select("*").in("listing_id",e)]);g&&console.error("Error fetching sellers:",g),i&&console.error("Error fetching media:",i),k&&console.error("Error fetching car details:",k);let{data:l}=await b.from("promoted_listings").select("listing_id, status, end_date").in("listing_id",e).eq("status","active").gt("end_date",new Date().toISOString()),m=c.map(a=>{let b=f?.find(b=>b.id===a.seller_id),c=h?.filter(b=>b.listing_id===a.id)||[],d=j?.find(b=>b.listing_id===a.id),e=l?.some(b=>b.listing_id===a.id);return{...a,seller:b||null,media:c||[],car_details:d||void 0,promoted:e||a.promoted}});console.log("Successfully combined data for",m.length,"listings"),D(m)}catch(a){console.error("Error in fetchListings:",a),H(`Failed to load listings: ${a?.message||"Unknown error"}`)}finally{F(!1)}};(0,c.useEffect)(()=>{I()},[]);let J=a=>{if(!a)return"Location not specified";if("string"==typeof a)try{a=JSON.parse(a)}catch{return a}if("object"==typeof a)try{"string"==typeof a&&(a=JSON.parse(a));let b=a;return b?.district||b?.sector||b?.cell||b?.village||b?.city||b?.province||b?.address||"Location not specified"}catch(a){console.log("Error parsing location:",a)}return"Location not specified"},K=C.filter(a=>{let b=a.title.toLowerCase().includes(q.toLowerCase())||a.car_details?.make?.toLowerCase().includes(q.toLowerCase())||a.car_details?.model?.toLowerCase().includes(q.toLowerCase())||J(a.location).toLowerCase().includes(q.toLowerCase()),c=a.price||0,d=parseInt(s.min)||0,e=parseInt(s.max)||1/0,f=(!s.min||c>=d)&&(!s.max||c<=e),g=!u||(a.car_details?.year_manufacture||0)>=parseInt(u),h=!w||a.car_details?.fuel_type===w,i=!y||a.car_details?.transmission===y,j="all"===A||a.transaction_type===A;return b&&f&&g&&h&&i&&j});return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 no-overflow-x",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center",children:[(0,b.jsx)(m.Car,{className:"h-6 w-6 sm:h-8 sm:w-8 mr-2 sm:mr-3 text-red-600"}),"Cars & Vehicles"]}),(0,b.jsxs)("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:["Find your perfect vehicle from ",C.length," listings"]})]}),(0,b.jsx)(d.default,{href:"/create-listing?category=cars",children:(0,b.jsx)(n.Button,{className:"bg-red-600 hover:bg-red-700 w-full sm:w-auto touch-target",children:"List Vehicle"})})]})})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-8",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[(0,b.jsx)("div",{className:"lg:w-80",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center mb-4",children:[(0,b.jsx)(f.Filter,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-gray-600"}),(0,b.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Filters"})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-2.5 sm:top-3 h-4 w-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:q,onChange:a=>r(a.target.value),placeholder:"Search by make, model, or location...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transaction Type"}),(0,b.jsxs)("select",{value:A,onChange:a=>B(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm","aria-label":"Transaction type",children:[(0,b.jsx)("option",{value:"all",children:"All Types"}),(0,b.jsx)("option",{value:"rent",children:"For Rent"}),(0,b.jsx)("option",{value:"sale",children:"For Sale"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Range (RWF)"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"number",value:s.min,onChange:a=>t({...s,min:a.target.value}),placeholder:"Min",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm"}),(0,b.jsx)("input",{type:"number",value:s.max,onChange:a=>t({...s,max:a.target.value}),placeholder:"Max",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Year"}),(0,b.jsxs)("select",{value:u,onChange:a=>v(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm","aria-label":"Minimum year",children:[(0,b.jsx)("option",{value:"",children:"Any Year"}),(0,b.jsx)("option",{value:"2023",children:"2023+"}),(0,b.jsx)("option",{value:"2022",children:"2022+"}),(0,b.jsx)("option",{value:"2021",children:"2021+"}),(0,b.jsx)("option",{value:"2020",children:"2020+"}),(0,b.jsx)("option",{value:"2019",children:"2019+"}),(0,b.jsx)("option",{value:"2018",children:"2018+"}),(0,b.jsx)("option",{value:"2017",children:"2017+"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fuel Type"}),(0,b.jsxs)("select",{value:w,onChange:a=>x(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm","aria-label":"Fuel type",children:[(0,b.jsx)("option",{value:"",children:"Any Fuel Type"}),(0,b.jsx)("option",{value:"Petrol",children:"Petrol"}),(0,b.jsx)("option",{value:"Diesel",children:"Diesel"}),(0,b.jsx)("option",{value:"Electric",children:"Electric"}),(0,b.jsx)("option",{value:"Hybrid",children:"Hybrid"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transmission"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm","aria-label":"Transmission type",children:[(0,b.jsx)("option",{value:"",children:"Any Transmission"}),(0,b.jsx)("option",{value:"Automatic",children:"Automatic"}),(0,b.jsx)("option",{value:"Manual",children:"Manual"})]})]}),(0,b.jsx)(n.Button,{variant:"outline",className:"w-full border-red-600 text-red-600 hover:bg-red-50 touch-target",onClick:()=>{r(""),t({min:"",max:""}),v(""),x(""),z(""),B("all")},children:"Clear Filters"})]})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsxs)("p",{className:"text-gray-600",children:["Showing ",K.length," of ",C.length," vehicles"]}),(0,b.jsxs)("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500","aria-label":"Sort options",children:[(0,b.jsx)("option",{children:"Sort by: Featured"}),(0,b.jsx)("option",{children:"Price: Low to High"}),(0,b.jsx)("option",{children:"Price: High to Low"}),(0,b.jsx)("option",{children:"Newest First"}),(0,b.jsx)("option",{children:"Most Viewed"})]})]}),E&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(m.Car,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading listings..."}),(0,b.jsx)("p",{className:"text-gray-600",children:"Please wait while we fetch the latest vehicles"})]}),G&&!E&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"text-red-600 text-6xl mb-4",children:"⚠️"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Unable to load listings"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:G}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Common issues:"}),(0,b.jsxs)("ul",{className:"text-sm text-gray-500 list-disc list-inside",children:[(0,b.jsx)("li",{children:"Check your Supabase connection"}),(0,b.jsx)("li",{children:"Verify you have car listings in your database"}),(0,b.jsx)("li",{children:"Ensure RLS policies allow reading listings"})]})]}),(0,b.jsx)(n.Button,{onClick:I,className:"mt-4 bg-red-600 hover:bg-red-700",children:"Try Again"})]}),!E&&!G&&(0,b.jsx)("div",{className:"grid grid-cols-1 xs:grid-cols-2 gap-4 sm:gap-6",children:K.map(a=>(0,b.jsxs)(o.Card,{className:"hover:shadow-lg transition-shadow group",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"w-full h-40 sm:h-48 bg-gray-200 rounded-t-lg flex items-center justify-center",children:a.media&&a.media.length>0?(0,b.jsx)("img",{src:a.media.find(a=>a.is_primary)?.url||a.media[0].url,alt:a.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105",onError:a=>{a.target.src="https://via.placeholder.com/400x300/cccccc/969696?text=Car+Image"}}):(0,b.jsx)("span",{className:"text-gray-500 text-sm sm:text-base",children:"Vehicle Image"})}),a.featured&&(0,b.jsx)("div",{className:"absolute top-2 left-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-semibold",children:"FEATURED"}),a.promoted&&(0,b.jsx)("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs font-semibold",children:"PROMOTED"}),(0,b.jsx)("div",{className:"absolute bottom-2 left-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded text-xs font-semibold capitalize",children:a.car_details?.vehicle_type||"Vehicle"})]}),(0,b.jsxs)(o.CardContent,{className:"p-3 sm:p-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2 text-sm sm:text-base",children:a.title}),(0,b.jsx)("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:(0,b.jsxs)("span",{className:"text-lg sm:text-2xl font-bold text-red-600",children:[a.currency," ",a.price.toLocaleString(),(0,b.jsx)("span",{className:"text-xs sm:text-sm text-gray-500 font-normal",children:"rent"===a.transaction_type?"/month":""})]})}),(0,b.jsxs)("p",{className:"text-gray-600 text-xs sm:text-sm mb-3 flex items-center",children:[(0,b.jsx)(g.MapPin,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),J(a.location)]}),(0,b.jsx)(p.default,{className:"mb-3 sm:mb-4"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600 mb-3 sm:mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(h.Calendar,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),a.car_details?.year_manufacture||"N/A"]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(i,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),a.car_details?.fuel_type||"N/A"]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(j.Settings,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),a.car_details?.transmission||"N/A"]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 text-xs sm:text-sm text-gray-500",children:[(0,b.jsxs)("span",{className:"flex items-center",children:[(0,b.jsx)(l.Eye,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),a.views||0]}),(0,b.jsxs)("span",{className:"flex items-center",children:[(0,b.jsx)(k.Heart,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),a.likes||0]}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),(0,b.jsx)(d.default,{href:`/listings/cars/${a.id}`,children:(0,b.jsx)(n.Button,{size:"sm",className:"bg-red-600 hover:bg-red-700 touch-target",children:"View Details"})})]})]})]},a.id))}),!E&&!G&&0===K.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(m.Car,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No vehicles found"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Try adjusting your filters or search criteria"}),(0,b.jsx)(n.Button,{variant:"outline",className:"w-full border-red-600 text-red-600 hover:bg-red-50 touch-target",onClick:()=>{r(""),t({min:"",max:""}),v(""),x(""),z(""),B("all")},children:"Clear All Filters"})]})]})]})})]})}a.s(["default",()=>q],37811)}];

//# sourceMappingURL=src_app_%5Blocale%5D_listings_cars_page_tsx_9754c914._.js.map