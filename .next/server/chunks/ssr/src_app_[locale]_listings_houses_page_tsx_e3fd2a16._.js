module.exports=[92278,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(87532),f=a.i(69012),g=a.i(24987),h=a.i(70106);let i=(0,h.default)("bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]]),j=(0,h.default)("bath",[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]]),k=(0,h.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var l=a.i(76472),m=a.i(77156),n=a.i(81010),o=a.i(99570),p=a.i(91119),q=a.i(68982),r=a.i(86304),s=a.i(66718),t=a.i(24507);function u(){let[a,h]=(0,c.useState)(""),[u,v]=(0,c.useState)({min:"",max:""}),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("all"),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)("");(0,c.useEffect)(()=>{I()},[]);let I=async()=>{try{F(!0),H(""),console.log("Starting to fetch house listings...");let{data:a,error:b}=await t.supabaseClient.from("listings").select("*").eq("category","houses").eq("status","available").order("created_at",{ascending:!1});if(b){console.error("Error fetching basic listings:",b),H(`Failed to load listings: ${b.message}`);return}if(console.log(`Found ${a?.length||0} listings`),!a||0===a.length){D([]),F(!1);return}let c=a.map(a=>a.id),[{data:d,error:e},{data:f,error:g},{data:h,error:i}]=await Promise.all([t.supabaseClient.from("users").select("id, full_name, email, avatar_url, phone_number, verified").in("id",a.map(a=>a.seller_id)),t.supabaseClient.from("listing_media").select("id, listing_id, url, public_id, media_type, order_index, is_primary").in("listing_id",c).order("order_index"),t.supabaseClient.from("house_details").select("*").in("listing_id",c)]);e&&console.error("Error fetching sellers:",e),g&&console.error("Error fetching media:",g),i&&console.error("Error fetching house details:",i);let{data:j}=await t.supabaseClient.from("promoted_listings").select("listing_id, status, end_date").in("listing_id",c).eq("status","active").gt("end_date",new Date().toISOString()),k=a.map(a=>{let b=d?.find(b=>b.id===a.seller_id),c=f?.filter(b=>b.listing_id===a.id)||[],e=h?.find(b=>b.listing_id===a.id),g=j?.some(b=>b.listing_id===a.id);return{...a,seller:b?{full_name:b.full_name,email:b.email}:null,media:c.map(a=>({url:a.url,media_type:a.media_type,is_primary:a.is_primary,order_index:a.order_index})),house_details:e?{bedrooms:e.bedrooms,bathrooms:e.bathrooms,total_area:e.total_area,furnished:e.furnished}:void 0,promoted:g||a.promoted}});console.log("Successfully combined data for",k.length,"listings"),D(k)}catch(a){console.error("Error in fetchListings:",a),H(`Failed to load listings: ${a?.message||"Unknown error"}`)}finally{F(!1)}},J=a=>{if(!a)return"Location not specified";if("string"==typeof a)try{a=JSON.parse(a)}catch{return a}if("object"==typeof a){let b=a;return b?.district||b?.sector||b?.cell||b?.village||b?.city||b?.province||b?.address||"Location not specified"}return"Location not specified"},K=C.filter(b=>{let c=b.title.toLowerCase().includes(a.toLowerCase())||J(b.location).toLowerCase().includes(a.toLowerCase()),d=(!u.min||b.price>=parseInt(u.min))&&(!u.max||b.price<=parseInt(u.max)),e=!w||b.house_details?.bedrooms&&b.house_details.bedrooms>=parseInt(w),f=!y||b.house_details?.bathrooms&&b.house_details.bathrooms>=parseInt(y),g="all"===A||b.transaction_type===A;return c&&d&&e&&f&&g});return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 no-overflow-x",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center",children:[(0,b.jsx)(n.Home,{className:"h-6 w-6 sm:h-8 sm:w-8 mr-2 sm:mr-3 text-red-600"}),"Houses & Apartments"]}),(0,b.jsxs)("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:["Find your perfect home from ",C.length," listings"]})]}),(0,b.jsx)(d.default,{href:"/create-listing?category=houses",children:(0,b.jsx)(o.Button,{className:"bg-red-600 hover:bg-red-700 w-full sm:w-auto touch-target",children:"List Property"})})]})})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-8",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[(0,b.jsx)("div",{className:"lg:w-80",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center mb-4",children:[(0,b.jsx)(f.Filter,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2 text-gray-600"}),(0,b.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Filters"})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-2.5 sm:top-3 h-4 w-4 text-gray-400"}),(0,b.jsx)(s.Input,{type:"text",placeholder:"Search by title or location...",value:a,onChange:a=>h(a.target.value),className:"pl-10 text-sm"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Range (RWF)"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(s.Input,{type:"number",placeholder:"Min",value:u.min,onChange:a=>v(b=>({...b,min:a.target.value})),className:"text-sm"}),(0,b.jsx)(s.Input,{type:"number",placeholder:"Max",value:u.max,onChange:a=>v(b=>({...b,max:a.target.value})),className:"text-sm"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bedrooms"}),(0,b.jsxs)("select",{value:w,onChange:a=>x(a.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm","aria-label":"Number of bedrooms",title:"Filter by number of bedrooms",children:[(0,b.jsx)("option",{value:"",children:"Any"}),(0,b.jsx)("option",{value:"1",children:"1+"}),(0,b.jsx)("option",{value:"2",children:"2+"}),(0,b.jsx)("option",{value:"3",children:"3+"}),(0,b.jsx)("option",{value:"4",children:"4+"}),(0,b.jsx)("option",{value:"5",children:"5+"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bathrooms"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm","aria-label":"Number of bathrooms",title:"Filter by number of bathrooms",children:[(0,b.jsx)("option",{value:"",children:"Any"}),(0,b.jsx)("option",{value:"1",children:"1+"}),(0,b.jsx)("option",{value:"2",children:"2+"}),(0,b.jsx)("option",{value:"3",children:"3+"}),(0,b.jsx)("option",{value:"4",children:"4+"})]})]}),(0,b.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),(0,b.jsxs)("select",{value:A,onChange:a=>B(a.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm","aria-label":"Transaction type",title:"Filter by transaction type",children:[(0,b.jsx)("option",{value:"all",children:"All"}),(0,b.jsx)("option",{value:"sale",children:"For Sale"}),(0,b.jsx)("option",{value:"rent",children:"For Rent"})]})]})]})}),(0,b.jsxs)("div",{className:"flex-1",children:[E&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading listings..."})]}),G&&!E&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"text-red-600 text-6xl mb-4",children:"âš ï¸"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Unable to load listings"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:G}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Common issues:"}),(0,b.jsxs)("ul",{className:"text-sm text-gray-500 list-disc list-inside",children:[(0,b.jsx)("li",{children:"Check your Supabase connection"}),(0,b.jsx)("li",{children:"Verify you have house listings in your database"}),(0,b.jsx)("li",{children:"Ensure RLS policies allow reading listings"})]})]}),(0,b.jsx)(o.Button,{onClick:I,className:"mt-4 bg-red-600 hover:bg-red-700",children:"Try Again"})]}),!E&&!G&&0===K.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ "}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No houses found"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Try adjusting your filters or search criteria"}),(0,b.jsx)(o.Button,{variant:"outline",className:"w-full border-red-600 text-red-600 hover:bg-red-50 touch-target",onClick:()=>{h(""),v({min:"",max:""}),x(""),z(""),B("all")},children:"Clear Filters"})]}),!E&&!G&&K.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-1 xs:grid-cols-2 gap-4 sm:gap-6",children:K.map(a=>{let c,e;return(0,b.jsx)(p.Card,{className:"hover:shadow-lg transition-shadow group",children:(0,b.jsxs)(p.CardContent,{className:"p-0",children:[(0,b.jsx)("div",{className:"relative",children:a.media&&a.media.length>0?(0,b.jsxs)("div",{className:"relative",children:["video"===a.media[0].media_type?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("video",{src:a.media[0].url,className:"w-full h-40 sm:h-48 object-cover",muted:!0,playsInline:!0}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30",children:(0,b.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white bg-opacity-90 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 sm:w-6 sm:h-6 text-gray-800 ml-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})})]}):(0,b.jsx)("img",{src:a.media[0].url,alt:a.title,className:"w-full h-40 sm:h-48 object-cover",onError:a=>{a.target.src="https://via.placeholder.com/400x300/cccccc/969696?text=House+Image"}}),a.media[0].is_primary&&(0,b.jsx)(r.Badge,{className:"absolute top-2 left-2 bg-red-600 text-white text-xs",children:"Primary"}),a.featured&&(0,b.jsx)("div",{className:"absolute top-2 left-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-semibold",children:"FEATURED"}),a.promoted&&(0,b.jsx)("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs font-semibold",children:"PROMOTED"})]}):(0,b.jsx)("div",{className:"w-full h-40 sm:h-48 bg-gray-200 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 text-3xl sm:text-4xl mb-2",children:"ðŸ“·"}),(0,b.jsx)("p",{className:"text-gray-500 text-xs sm:text-sm",children:"No media available"})]})})}),(0,b.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"mb-3 sm:mb-4",children:[(0,b.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:a.title}),(0,b.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-red-600",children:(c=a.price,e=a.currency,new Intl.NumberFormat("en-RW",{style:"currency",currency:"RWF"===e?"RWF":"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c))})]}),a.house_details&&(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600 mb-3 sm:mb-4",children:[a.house_details.bedrooms&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(i,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.house_details.bedrooms," beds"]}),a.house_details.bathrooms&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(j,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.house_details.bathrooms," baths"]}),a.house_details.total_area&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(k,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.house_details.total_area,"mÂ²"]})]}),(0,b.jsxs)("div",{className:"flex items-center text-gray-500 text-xs sm:text-sm mb-3 sm:mb-4",children:[(0,b.jsx)(g.MapPin,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),J(a.location)]}),(0,b.jsx)(q.default,{className:"mb-3 sm:mb-4"}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 text-xs sm:text-sm text-gray-500",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.Eye,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.views||0]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(l.Heart,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.likes||0]}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),(0,b.jsx)(o.Button,{asChild:!0,size:"sm",className:"touch-target",children:(0,b.jsx)(d.default,{href:`/listings/houses/${a.id}`,children:"View Details"})})]})]})]})},a.id)})})]})]})})]})}a.s(["default",()=>u],92278)}];

//# sourceMappingURL=src_app_%5Blocale%5D_listings_houses_page_tsx_e3fd2a16._.js.map