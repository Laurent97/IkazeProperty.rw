module.exports=[16550,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(210),f=a.i(24987),g=a.i(46842),h=a.i(99570),i=a.i(91119),j=a.i(86304),k=a.i(68982);function l(){let l=(0,d.useRouter)(),{category:m,id:n}=(0,d.useParams)(),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)("mtn_momo"),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)("bitcoin"),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)([]),Q=async b=>{try{let{supabaseClient:c}=await a.A(53215),{data:d,error:e}=await c.from("listings").select(`
          id,
          title,
          price,
          currency,
          location,
          transaction_type,
          price_type,
          media:listing_media(
            url,
            media_type
          ).order('is_primary', { ascending: false }).limit(1)
        `).eq("category",b.category).eq("status","available").neq("id",b.id).limit(6).order("created_at",{ascending:!1});e?console.error("Error fetching similar listings:",e):x(d||[])}catch(a){console.error("Error fetching similar listings:",a)}};if((0,c.useEffect)(()=>{let b=!0;return(async()=>{if(n){t(!0),z("");try{let{supabaseClient:c}=await a.A(53215),{data:d,error:e}=await c.from("listings").select(`
            *,
            seller:users!listings_seller_id_fkey(
              id,
              full_name,
              email,
              avatar_url
            ),
            listing_media(
              id,
              url,
              public_id,
              media_type,
              order_index,
              is_primary
            )
          `).eq("id",n).single();if(e||!d||d.category!==m){b&&(z("Listing not found"),t(!1));return}let{data:f,error:g}=await c.from("listing_media").select("*").eq("listing_id",n).order("order_index",{ascending:!0});console.log("ðŸ“¸ Media query result:",{listingId:n,mediaData:f,mediaError:g,mediaCount:f?.length||0}),b&&(p(d),r(f||[]),v(0),t(!1)),d&&Q(d)}catch(a){console.error("Error fetching listing:",a),b&&(z("Listing not found"),t(!1))}}})(),()=>{b=!1}},[m,n]),s)return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 no-overflow-x",children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto px-3 sm:px-4 lg:px-6 lg:px-8 py-4 sm:py-8",children:(0,b.jsx)("p",{className:"text-gray-600 text-sm sm:text-base",children:"Loading listing..."})})});if(y||!o)return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 no-overflow-x",children:[(0,b.jsxs)("div",{className:"max-w-5xl mx-auto px-3 sm:px-4 lg:px-6 lg:px-8 py-4 sm:py-8",children:[(0,b.jsxs)(h.Button,{variant:"outline",onClick:()=>l.back(),className:"touch-target",children:[(0,b.jsx)(e.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,b.jsx)("div",{className:"mt-4 sm:mt-6 text-gray-700 text-sm sm:text-base",children:y||"Listing not found"})]}),w.length>0&&(0,b.jsx)("div",{className:"mt-12",children:(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Similar Items You Might Like"})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:w.map(a=>{let c;return(0,b.jsx)(i.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer touch-target",children:(0,b.jsxs)(i.CardContent,{className:"p-3 sm:p-4",children:[(0,b.jsx)("div",{className:"relative",children:a.media&&a.media.length>0?(0,b.jsx)("img",{src:a.media[0].url,alt:a.title,className:"w-full h-24 sm:h-28 md:h-32 object-cover rounded-lg"}):(0,b.jsxs)("div",{className:"w-full h-24 sm:h-28 md:h-32 bg-gray-200 rounded-lg flex items-center justify-center",children:[(0,b.jsx)("div",{className:"text-gray-400 text-2xl sm:text-3xl mb-1 sm:mb-2",children:"ðŸ“·"}),(0,b.jsx)("p",{className:"text-gray-500 text-xs sm:text-sm",children:"No media available"})]})}),(0,b.jsxs)("div",{className:"mt-2 sm:mt-3",children:[(0,b.jsx)("h4",{className:"text-sm sm:text-base lg:text-lg font-semibold text-gray-900 mb-1 line-clamp-1",children:a.title}),(0,b.jsxs)("div",{className:"text-base sm:text-lg lg:text-xl font-bold text-red-600 mb-1 sm:mb-2",children:[a.currency," ",a.price?.toLocaleString()]}),(0,b.jsxs)("div",{className:"text-xs sm:text-sm text-gray-600 capitalize",children:[a.transaction_type," â€¢ ",a.price_type]}),(0,b.jsxs)("div",{className:"flex items-center text-xs sm:text-sm text-gray-500 mt-1",children:[(0,b.jsx)(f.MapPin,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),(console.log("ðŸ“ Similar listing location:",c=a.location),c)?"string"==typeof c?c:"object"==typeof c&&null!==c&&(c.district||c.sector||c.province)||"Location not specified":"Location not specified"]})]})]})},a.id)})})})]})})]});q.find(a=>a.is_primary)||q[0];let R=o.price?.toLocaleString()||"0",S=o.location,T=a=>"string"==typeof a?a:"object"==typeof a&&null!==a?Object.values(a).filter(Boolean).join(", "):"",U=o.visit_fee_amount||15e3,V=o.visit_fee_payment_methods||{},W=async()=>{try{let a=await fetch("/api/payments/methods"),b=await a.json();if(a.ok&&b?.methods){let a=b.methods.filter(a=>a.isActive).map(a=>a.id);P(a),a.length>0&&D(a[0])}}catch(a){console.error("Error loading payment methods:",a),P(["mtn_momo","airtel_money","equity_bank","crypto","wallet"]),D("mtn_momo")}},X=async()=>{J(!0),L(""),N("");try{let{supabaseClient:b}=await a.A(53215),{data:{session:c}}=await b.auth.getSession();if(!c?.access_token)return void L("Please login to request a visit");let d=await fetch("/api/visits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.access_token}`},body:JSON.stringify({listing_id:o.id,payment_method:C,phone_number:E,crypto_type:G})}),e=await d.json();if(!d.ok)return void L(e.error||"Failed to request visit");N("Visit request submitted. Please complete the payment prompt.")}catch(a){L(a.message||"Failed to request visit")}finally{J(!1)}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsxs)("div",{className:"max-w-5xl mx-auto px-3 sm:px-4 lg:px-6 lg:px-8 py-4 sm:py-8",children:[(0,b.jsxs)(h.Button,{variant:"outline",onClick:()=>l.back(),className:"touch-target",children:[(0,b.jsx)(e.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,b.jsxs)("div",{className:"mt-4 sm:mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-4 sm:space-y-6",children:[(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"relative",children:q.length>0?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative group",children:[q[u]?.media_type==="video"?(0,b.jsxs)("div",{className:"relative aspect-video bg-gray-100 rounded-lg overflow-hidden",children:[(0,b.jsx)("video",{src:q[u].url,className:"w-full h-48 sm:h-64 md:h-80 lg:h-96 object-cover",controls:!0,autoPlay:!1}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)("div",{className:"w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-gray-800",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})})]}):(0,b.jsx)("img",{src:q[u]?.url,alt:o.title,className:"w-full h-48 sm:h-64 md:h-80 lg:h-96 object-cover rounded-lg"}),q.length>1&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>v(a=>0===a?q.length-1:a-1),className:"absolute left-2 sm:left-4 top-1/2 transform -translate-y-1/2 w-8 h-8 sm:w-10 sm:h-10 bg-white bg-opacity-90 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg touch-target","aria-label":"Previous image",children:(0,b.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,b.jsx)("button",{onClick:()=>v(a=>(a+1)%q.length),className:"absolute right-2 sm:right-4 top-1/2 transform -translate-y-1/2 w-8 h-8 sm:w-10 sm:h-10 bg-white bg-opacity-90 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg touch-target","aria-label":"Next image",children:(0,b.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),q[u]?.is_primary&&(0,b.jsx)(j.Badge,{className:"absolute top-2 sm:top-4 left-2 sm:left-4 bg-red-600 text-white text-xs",children:"Primary"}),q[u]?.media_type==="video"&&(0,b.jsx)(j.Badge,{className:"absolute top-2 sm:top-4 right-2 sm:right-4 bg-blue-600 text-white text-xs",children:"Video"})]}),q.length>1&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-1.5 sm:gap-2 mt-3 sm:mt-4",children:q.map((a,c)=>(0,b.jsxs)("div",{className:`relative group cursor-pointer ${u===c?"ring-2 ring-blue-500 rounded-lg":""}`,onClick:()=>v(c),children:["video"===a.media_type?(0,b.jsxs)("div",{className:"relative aspect-video bg-gray-100 rounded-lg overflow-hidden",children:[(0,b.jsx)("video",{src:a.url,className:"w-full h-full object-cover",muted:!0,onMouseEnter:a=>{let b=a.target;b&&b.play()},onMouseLeave:a=>{let b=a.target;b&&b.pause()}}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,b.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})]}):(0,b.jsx)("img",{src:a.url,alt:`${o.title} - ${c+1}`,className:"w-full h-14 sm:h-16 md:h-20 object-cover rounded-lg"}),a.is_primary&&(0,b.jsx)("div",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]},a.id))}),(0,b.jsx)("div",{className:"flex justify-center space-x-1.5 sm:space-x-2 mt-3 sm:mt-4",children:q.map((a,c)=>(0,b.jsx)("button",{onClick:()=>v(c),className:`w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-colors touch-target ${u===c?"bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`,"aria-label":`Go to image ${c+1}`},c))})]})]}):(0,b.jsx)("div",{className:"w-full h-48 sm:h-64 md:h-80 lg:h-96 bg-gray-200 rounded-lg flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 text-4xl sm:text-5xl md:text-6xl mb-2",children:"ðŸ“·"}),(0,b.jsx)("p",{className:"text-gray-500 text-xs sm:text-sm",children:"No media available"})]})})})})}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Description"})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-line",children:o.description})})]})]}),(0,b.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:o.title})}),(0,b.jsxs)(i.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[o.currency," ",R]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600 capitalize",children:[o.transaction_type," â€¢ ",o.price_type]}),(0,b.jsxs)("div",{className:"flex items-start text-sm text-gray-700",children:[(0,b.jsx)(f.MapPin,{className:"h-4 w-4 mr-2 mt-0.5 text-gray-500"}),(0,b.jsx)("div",{children:[T(S?.address),T(S?.sector),T(S?.district),T(S?.province)].filter(Boolean).join(", ")||"Location not provided"})]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Seller"})}),(0,b.jsxs)(i.CardContent,{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)(g.User,{className:"h-5 w-5 text-gray-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:o.seller?.full_name||"Unknown Seller"}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:o.seller?.email||"No email"})]})]}),(0,b.jsx)(i.CardContent,{className:"pt-0",children:(0,b.jsx)(k.default,{})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Visit Fee"})}),(0,b.jsxs)(i.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-700",children:["Visit fee: ",(0,b.jsxs)("strong",{children:[U.toLocaleString()," RWF"]})]}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Seller receives 70%. Platform keeps 30%."}),(0,b.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-xs text-gray-700 space-y-1",children:[V.mtn_momo?.phone_number&&(0,b.jsxs)("div",{children:["MTN MoMo: ",V.mtn_momo.phone_number]}),V.airtel_money?.phone_number&&(0,b.jsxs)("div",{children:["Airtel Money: ",V.airtel_money.phone_number]}),V.equity_bank?.account_number&&(0,b.jsxs)("div",{children:["Equity: ",V.equity_bank.account_name||"Account"," â€¢ ",V.equity_bank.account_number]})]}),(0,b.jsx)(h.Button,{onClick:()=>{W(),B(!0)},className:"w-full bg-red-600 hover:bg-red-700",children:"Request a Visit"})]})]})]})]})]}),A&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 sm:p-4 z-50",children:(0,b.jsx)(i.Card,{className:"w-full max-w-md",children:(0,b.jsxs)(i.CardContent,{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-base sm:text-lg font-semibold",children:"Request a Visit"}),(0,b.jsx)("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600 touch-target p-1","aria-label":"Close modal",children:"Ã—"})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-700",children:["Visit fee: ",(0,b.jsxs)("strong",{children:[U.toLocaleString()," RWF"]})]}),K&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:K}),M&&(0,b.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-700",children:M}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),(0,b.jsx)("select",{value:C,onChange:a=>D(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",title:"Payment Method Selection",children:O.map(a=>(0,b.jsx)("option",{value:a,children:{mtn_momo:"MTN Mobile Money",airtel_money:"Airtel Money",equity_bank:"Equity Bank",crypto:"Cryptocurrency",wallet:"Wallet Balance"}[a]||a},a))}),("mtn_momo"===C||"airtel_money"===C)&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,b.jsx)("input",{type:"tel",value:E,onChange:a=>F(a.target.value),placeholder:"078X XXX XXX",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),"crypto"===C&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cryptocurrency"}),(0,b.jsxs)("select",{value:G,onChange:a=>H(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",title:"Cryptocurrency Selection",children:[(0,b.jsx)("option",{value:"bitcoin",children:"Bitcoin"}),(0,b.jsx)("option",{value:"ethereum",children:"Ethereum"}),(0,b.jsx)("option",{value:"usdt",children:"USDT"})]})]})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>B(!1),className:"flex-1",children:"Cancel"}),(0,b.jsx)(h.Button,{onClick:X,disabled:I,className:"flex-1 bg-red-600 hover:bg-red-700",children:I?"Submitting...":"Pay Visit Fee"})]})]})})})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=src_app_%5Blocale%5D_listings_%5Bcategory%5D_%5Bid%5D_page_tsx_e3ba8323._.js.map