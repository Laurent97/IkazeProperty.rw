{"version":3,"sources":["../../../../src/app/%5Blocale%5D/auth/callback/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { supabase } from '@/lib/auth'\n\nexport default function AuthCallback() {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        // Get the session from the URL hash\n        const { data, error } = await supabase.auth.getSession()\n        \n        if (error) {\n          console.error('Auth callback error:', error)\n          setError('Authentication failed. Please try again.')\n          setTimeout(() => {\n            router.push('/login')\n          }, 3000)\n          return\n        }\n\n        if (data.session) {\n          // User successfully signed in\n          console.log('User authenticated:', data.session.user)\n          \n          // Check if user profile exists, create if not\n          const { data: profile, error: profileError } = await supabase\n            .from('users')\n            .select('*')\n            .eq('id', data.session.user.id)\n            .single()\n\n          if (profileError && profileError.code === 'PGRST116') {\n            // Profile doesn't exist, create one\n            const { error: insertError } = await (supabase\n              .from('users') as any)\n              .insert({\n                email: data.session.user.email || '',\n                full_name: data.session.user.user_metadata?.full_name || data.session.user.user_metadata?.name || null,\n                avatar_url: data.session.user.user_metadata?.avatar_url || null,\n                role: 'user',\n                verified: true\n              })\n\n            if (insertError) {\n              console.error('Error creating profile:', insertError)\n            }\n          }\n\n          // Redirect to dashboard or home\n          router.push('/dashboard')\n        } else {\n          // No session found, redirect to login\n          router.push('/login')\n        }\n      } catch (err) {\n        console.error('Callback error:', err)\n        setError('An error occurred during authentication.')\n        setTimeout(() => {\n          router.push('/login')\n        }, 3000)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    handleAuthCallback()\n  }, [router])\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Completing sign in...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"text-red-600 mb-4\">\n            <svg className=\"w-16 h-16 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n            </svg>\n          </div>\n          <p className=\"text-gray-600\">{error}</p>\n          <p className=\"text-sm text-gray-500 mt-2\">Redirecting to login page...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return null\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,YAiElD,CA/DA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KA4DR,CA3D2B,UACzB,GAAI,CAEF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAAC,IAAI,CAAC,UAAU,GAEtD,GAAI,EAAO,CACT,QAAQ,KAAK,CAAC,uBAAwB,GACtC,EAAS,4CACT,WAAW,KACT,EAAO,IAAI,CAAC,SACd,EAAG,KACH,MACF,CAEA,GAAI,EAAK,OAAO,CAAE,CAEhB,QAAQ,GAAG,CAAC,sBAAuB,EAAK,OAAO,CAAC,IAAI,EAGpD,GAAM,CAAE,KAAM,CAAO,CAAE,MAAO,CAAY,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC1D,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,EAAK,OAAO,CAAC,IAAI,CAAC,EAAE,EAC7B,MAAM,GAET,GAAI,GAAsC,aAAtB,EAAa,IAAI,CAAiB,CAEpD,GAAM,CAAE,MAAO,CAAW,CAAE,CAAG,MAAO,EAAA,QAAQ,CAC3C,IAAI,CAAC,SACL,MAAM,CAAC,CACN,MAAO,EAAK,OAAO,CAAC,IAAI,CAAC,KAAK,EAAI,GAClC,UAAW,EAAK,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,WAAa,EAAK,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,MAAQ,KAClG,WAAY,EAAK,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,YAAc,KAC3D,KAAM,OACN,UAAU,CACZ,EAEE,IACF,QAAQ,CADO,IACF,CAAC,0BAA2B,EAE7C,CAGA,EAAO,IAAI,CAAC,aACd,MAEE,CAFK,CAEE,IAAI,CAAC,SAEhB,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,kBAAmB,GACjC,EAAS,4CACT,WAAW,KACT,EAAO,IAAI,CAAC,SACd,EAAG,IACL,QAAU,CACR,GAAW,EACb,EACF,GAGF,EAAG,CAAC,EAAO,EAEP,GAEA,CAAA,EAAA,EAAA,CAFS,EAET,EAAC,MAAA,CAAI,UAAU,oEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2EACf,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8BAAqB,+BAMtC,EAEA,CAAA,EAAA,EAFO,AAEP,GAAA,EAAC,MAAA,CAAI,UAAU,oEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oBAAoB,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC3E,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,kJAGzE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yBAAiB,IAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,sCAM3C,IACT"}